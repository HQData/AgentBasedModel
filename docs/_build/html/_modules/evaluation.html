
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>evaluation &#8212; ABMHAP 2018.06 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evaluation</h1><div class="highlight"><pre>
<span></span><span class="c1"># The United States Environmental Protection Agency through its Office of</span>
<span class="c1"># Research and Development has developed this software. The code is made</span>
<span class="c1"># publicly available to better communicate the research. All input data</span>
<span class="c1"># used fora given application should be reviewed by the researcher so</span>
<span class="c1"># that the model results are based on appropriate data for any given</span>
<span class="c1"># application. This model is under continued development. The model and</span>
<span class="c1"># data included herein do not represent and should not be construed to</span>
<span class="c1"># represent any Agency determination or policy.</span>
<span class="c1">#</span>
<span class="c1"># This file was written by Dr. Namdi Brandon</span>
<span class="c1"># ORCID: 0000-0001-7050-1538</span>
<span class="c1"># March 22, 2018</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module is used to for evaluating the accuracy of the Agent-Based Model of Human \</span>
<span class="sd">Activity Patterns (ABMHAP) simulation results vs. Consolidated Human Activity Database \</span>
<span class="sd">(CHAD) data.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ===========================================</span>
<span class="c1"># import</span>
<span class="c1"># ===========================================</span>

<span class="c1"># python modules</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">zipfile</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">source&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">run&#39;</span><span class="p">)</span>

<span class="c1"># plotting capability</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># mathematical capability</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># dataframe capability</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># statistical capability</span>
<span class="kn">import</span> <span class="nn">statsmodels</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="c1"># for smoothing</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">integrate</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">kde</span>

<span class="c1"># ABMHAP modules</span>
<span class="kn">import</span> <span class="nn">my_globals</span> <span class="k">as</span> <span class="nn">mg</span>
<span class="kn">import</span> <span class="nn">demography</span> <span class="k">as</span> <span class="nn">dmg</span>
<span class="kn">import</span> <span class="nn">analysis</span><span class="o">,</span> <span class="nn">activity</span><span class="o">,</span> <span class="nn">chad</span><span class="o">,</span> <span class="nn">diary</span><span class="o">,</span> <span class="nn">temporal</span><span class="o">,</span> <span class="nn">trial</span>

<span class="c1"># ===========================================</span>
<span class="c1"># constants</span>
<span class="c1"># ===========================================</span>

<span class="c1"># # given an activity code, give the name of the corresponding .zip file for the CHAD data</span>
<span class="c1"># ACTIVITY_TO_CHAD = {activity.COMMUTE_FROM_WORK: chad.FNAME_COMMUTE_FROM_WORK,</span>
<span class="c1">#                 activity.COMMUTE_TO_WORK: chad.FNAME_COMMUTE_TO_WORK,</span>
<span class="c1">#                 activity.EAT_BREAKFAST: chad.FNAME_EAT_BREAKFAST,</span>
<span class="c1">#                 activity.EAT_DINNER: chad.FNAME_EAT_DINNER,</span>
<span class="c1">#                 activity.EAT_LUNCH: chad.FNAME_EAT_LUNCH,</span>
<span class="c1">#                 activity.SLEEP: chad.FNAME_SLEEP,</span>
<span class="c1">#                 activity.WORK: chad.FNAME_WORK,}</span>
<span class="c1">#</span>
<span class="c1"># ACTIVITY_TO_DATA = { activity.COMMUTE_FROM_WORK: chad.FNAME_COMMUTE_FROM_WORK,</span>
<span class="c1">#                      activity.COMMUTE_TO_WORK: chad.FNAME_COMMUTE_TO_WORK,</span>
<span class="c1">#                      activity.EAT_BREAKFAST: chad.FNAME_EAT_BREAKFAST,</span>
<span class="c1">#                      activity.EAT_DINNER: chad.FNAME_EAT_DINNER,</span>
<span class="c1">#                      activity.EAT_LUNCH: chad.FNAME_EAT_LUNCH,</span>
<span class="c1">#                      activity.SLEEP: chad.FNAME_SLEEP,</span>
<span class="c1">#                      activity.WORK: chad.FNAME_WORK,</span>
<span class="c1"># }</span>

<span class="c1"># ===========================================</span>
<span class="c1"># functions</span>
<span class="c1"># ===========================================</span>

<div class="viewcode-block" id="compare_abm_to_chad"><a class="viewcode-back" href="../evaluation.html#evaluation.compare_abm_to_chad">[docs]</a><span class="k">def</span> <span class="nf">compare_abm_to_chad</span><span class="p">(</span><span class="n">demo</span><span class="p">,</span> <span class="n">df_list</span><span class="p">,</span> <span class="n">trial_code</span><span class="p">,</span> <span class="n">fidx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">do_save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function compares the results of the ABMHAP to the CHAD data by showing by</span>

<span class="sd">    #. plotting cumulative distribution functions (CDF) of the predicted (ABMHAP) and \</span>
<span class="sd">    observed (CHAD) single-day data for each activity</span>
<span class="sd">    #. plotting the residual (that difference between the CDFs) between the predicted \</span>
<span class="sd">    (ABMHAP) and observed (CHAD) data for each activity</span>

<span class="sd">    :param int demo: the demographic identifier</span>
<span class="sd">    :param df_list: the ABMHAP activity diaries to compare</span>
<span class="sd">    :type df_list: list of  pandas.core.frame.DataFrame</span>
<span class="sd">    :param int trial_code: the trial identifier</span>
<span class="sd">    :param int fidx: the figure identifier for the first figure in a series of figures</span>
<span class="sd">    :param bool do_save: a flag indicating whether (if True) or not (if False) to save \</span>
<span class="sd">    the figures</span>
<span class="sd">    :param str fpath: the file path of the figures that are to be saved</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># the activity codes</span>
    <span class="n">act_codes</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">TRIAL_2_ACTIVITY</span><span class="p">[</span><span class="n">trial_code</span><span class="p">]</span>

    <span class="c1"># the .zip file for the CHAD data corresponding to the demographic</span>
    <span class="n">fname_zip</span>   <span class="o">=</span> <span class="n">dmg</span><span class="o">.</span><span class="n">FNAME_DEMOGRAPHY</span><span class="p">[</span><span class="n">demo</span><span class="p">]</span>

    <span class="c1"># open the .zip file</span>
    <span class="n">z</span>           <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">fname_zip</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="c1"># for each activity compare the ABMHAP results to the CHAD data</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">act_codes</span><span class="p">:</span>

        <span class="c1"># the ABM data (predicted)</span>
        <span class="n">df_abm</span>  <span class="o">=</span> <span class="n">sample_activity_abm</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">act</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># the CHAD single event data (observed)</span>
        <span class="c1">#</span>
        <span class="n">fname_record</span>    <span class="o">=</span> <span class="n">chad</span><span class="o">.</span><span class="n">FNAME_RECORD_OMNI</span><span class="p">[</span><span class="n">act</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># get the single-day data records for the given activity</span>
        <span class="n">df_obs</span>          <span class="o">=</span> <span class="n">get_solo_data</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fname_record</span><span class="p">)</span>

        <span class="c1"># plot the comparision of the predicted (ABMHAP) and observed data (CHAD)</span>
        <span class="n">fid_last</span>        <span class="o">=</span> <span class="n">compare_abm_to_chad_help</span><span class="p">(</span><span class="n">df_abm</span><span class="o">=</span><span class="n">df_abm</span><span class="p">,</span> <span class="n">df_obs</span><span class="o">=</span><span class="n">df_obs</span><span class="p">,</span> <span class="n">act_code</span><span class="o">=</span><span class="n">act</span><span class="p">,</span> <span class="n">fidx</span><span class="o">=</span><span class="n">fidx</span><span class="p">,</span> \
                                                   <span class="n">do_save</span><span class="o">=</span><span class="n">do_save</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="n">fpath</span><span class="p">)</span>
        <span class="c1"># the new figure identifier</span>
        <span class="n">fidx</span>            <span class="o">=</span> <span class="n">fid_last</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># close the .zip file</span>
    <span class="n">z</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="compare_abm_to_chad_help"><a class="viewcode-back" href="../evaluation.html#evaluation.compare_abm_to_chad_help">[docs]</a><span class="k">def</span> <span class="nf">compare_abm_to_chad_help</span><span class="p">(</span><span class="n">df_abm</span><span class="p">,</span> <span class="n">df_obs</span><span class="p">,</span> <span class="n">act_code</span><span class="p">,</span> <span class="n">fidx</span><span class="p">,</span> <span class="n">do_save</span><span class="p">,</span> <span class="n">fpath</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function compares the results of the ABMHAP to the CHAD data for a given activity by</span>

<span class="sd">    #. plotting cumulative distribution functions (CDF) of the predicted (ABMHAP) and \</span>
<span class="sd">    observed (CHAD) single-day data for each activity</span>
<span class="sd">    #. plotting the residual (that difference between the CDFs) between the predicted \</span>
<span class="sd">    (ABMHAP) and observed (CHAD) data for each activity</span>

<span class="sd">    :param pandas.core.frame.DataFrame df_abm: the predicted (ABMHAP) data for the respective activity</span>
<span class="sd">    :param pandas.core.frame.DataFrame df_obs: the single-day observed (CHAD) data for the respective activity</span>
<span class="sd">    :param float act_code: the activity code</span>
<span class="sd">    :param int fidx: the figure identifier of the first figure</span>
<span class="sd">    :param bool do_save: a flag indicating whether (if True) or not (if False) to save \</span>
<span class="sd">    the figures</span>
<span class="sd">    :param str fpath: the file path of the figures that are to be saved</span>

<span class="sd">    :return: the last figure identifier plotted</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># sample with replacement</span>

    <span class="c1"># these activities could potential start before midnight and end after midnight</span>
    <span class="n">chooser</span>     <span class="o">=</span> <span class="p">{</span><span class="n">activity</span><span class="o">.</span><span class="n">SLEEP</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="p">}</span>

    <span class="c1"># a flag indicating whether (if True) or not (if False) to represent the time in [-12, 12)</span>
    <span class="n">do_periodic</span> <span class="o">=</span> <span class="n">chooser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">act_code</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># the number of plots to make in plot()</span>
    <span class="c1"># (start, end, dt) * (cdf + inverse_cdf + res + inverse_res + res_scaled + res_scaled_inv )</span>
    <span class="n">n_plots</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="c1"># figure ids</span>
    <span class="n">fids</span> <span class="o">=</span> <span class="n">fidx</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_plots</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">df_abm</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>

        <span class="c1"># the number of samples</span>
        <span class="c1"># normally the CHAd dataframe should be much larger than the ABM runs. In the rare event, we run more CHAD</span>
        <span class="c1"># simulations than the CHAD observed data, we can still do analysis</span>

        <span class="c1"># sample the predicted and observed data</span>
        <span class="n">x_abm</span>   <span class="o">=</span> <span class="n">df_abm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_abm</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># need to sample a random person and a random day</span>
        <span class="c1">#</span>

        <span class="c1"># randomly choose the person to sample</span>
        <span class="n">pid</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span> <span class="n">df_obs</span><span class="o">.</span><span class="n">PID</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_obs</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>

        <span class="c1"># group the data by pid</span>
        <span class="n">gb</span>      <span class="o">=</span> <span class="n">df_obs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;PID&#39;</span><span class="p">)</span>

        <span class="c1"># randomly choose 1 activity event from the person</span>
        <span class="n">x_obs</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="p">[</span> <span class="n">gb</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pid</span> <span class="p">]</span> <span class="p">)</span>

        <span class="c1"># the number of times that CDF was sampled</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># get the duration data</span>
        <span class="n">x_dt</span><span class="p">,</span> <span class="n">cdf_dt</span><span class="p">,</span> <span class="n">inv_cdf_dt</span>            <span class="o">=</span> <span class="n">residual_analysis</span><span class="p">(</span><span class="n">pred</span><span class="o">=</span><span class="n">x_abm</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="n">x_obs</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

        <span class="c1"># get the start time data</span>
        <span class="n">x_start</span><span class="p">,</span> <span class="n">cdf_start</span><span class="p">,</span> <span class="n">inv_cdf_start</span>   <span class="o">=</span> <span class="n">residual_analysis</span><span class="p">(</span><span class="n">pred</span><span class="o">=</span><span class="n">x_abm</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="n">x_obs</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> \
                                                                <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">do_periodic</span><span class="o">=</span><span class="n">do_periodic</span><span class="p">)</span>

        <span class="c1"># get the end time data</span>
        <span class="n">x_end</span><span class="p">,</span> <span class="n">cdf_end</span><span class="p">,</span> <span class="n">inv_cdf_end</span> <span class="o">=</span> <span class="n">residual_analysis</span><span class="p">(</span><span class="n">pred</span><span class="o">=</span><span class="n">x_abm</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="n">x_obs</span><span class="o">.</span><span class="n">end</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> \
                                                              <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">do_periodic</span><span class="o">=</span><span class="n">do_periodic</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># plot the distribution data for duration, start time, and end time</span>
        <span class="c1">#</span>

        <span class="c1"># quantile range information</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

        <span class="c1"># plot duration results</span>
        <span class="n">figs_dt</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">x_dt</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf_dt</span><span class="p">,</span> <span class="n">inv_cdf_dt</span><span class="p">,</span> <span class="n">act_code</span><span class="p">,</span> <span class="n">fids</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">do_hours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dname</span><span class="o">=</span><span class="s1">&#39;Duration&#39;</span><span class="p">)</span>

        <span class="c1"># plot start time results</span>
        <span class="n">fids</span> <span class="o">=</span> <span class="n">fids</span> <span class="o">+</span> <span class="n">n_plots</span>
        <span class="n">figs_start</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf_start</span><span class="p">,</span> <span class="n">inv_cdf_start</span><span class="p">,</span> <span class="n">act_code</span><span class="p">,</span> <span class="n">fids</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">do_hours</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dname</span><span class="o">=</span><span class="s1">&#39;Start Time&#39;</span><span class="p">)</span>

        <span class="c1"># plot end time results</span>
        <span class="n">fids</span> <span class="o">=</span> <span class="n">fids</span> <span class="o">+</span> <span class="n">n_plots</span>
        <span class="n">figs_end</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">x_end</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf_end</span><span class="p">,</span> <span class="n">inv_cdf_end</span><span class="p">,</span> <span class="n">act_code</span><span class="p">,</span> <span class="n">fids</span><span class="o">=</span><span class="n">fids</span><span class="p">,</span> <span class="n">do_hours</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dname</span><span class="o">=</span><span class="s1">&#39;End Time&#39;</span><span class="p">)</span>

        <span class="c1"># save the plots</span>
        <span class="k">if</span> <span class="n">do_save</span><span class="p">:</span>
            <span class="n">save_figures</span><span class="p">(</span><span class="n">act</span><span class="o">=</span><span class="n">act_code</span><span class="p">,</span> <span class="n">figs_start</span><span class="o">=</span><span class="n">figs_start</span><span class="p">,</span> <span class="n">figs_end</span><span class="o">=</span><span class="n">figs_end</span><span class="p">,</span> <span class="n">figs_dt</span><span class="o">=</span><span class="n">figs_dt</span><span class="p">,</span> <span class="n">fpath</span><span class="o">=</span><span class="n">fpath</span><span class="p">)</span>

    <span class="c1"># return the last figure ID plotted</span>
    <span class="k">return</span> <span class="n">fids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>
<span class="c1">#</span>
<span class="c1"># def get_diary_list(u_list):</span>
<span class="c1">#</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Given all of the simuluation data and creates a list of data frames showing the activity diary for each person \</span>
<span class="c1">#     in the simulation.</span>
<span class="c1">#</span>
<span class="c1">#     :param list u_list: the simulation data (:class:`universe.Universe`) for each household simulation</span>
<span class="c1">#     :return:</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     # each activity diary in the simulation</span>
<span class="c1">#     diary_list = list()</span>
<span class="c1">#</span>
<span class="c1">#     # the time of each step in the simulation [universal time, minutes]</span>
<span class="c1">#     for u in u_list:</span>
<span class="c1">#</span>
<span class="c1">#         # the time in the simulation</span>
<span class="c1">#         t = u.hist_time</span>
<span class="c1">#</span>
<span class="c1">#         # the household diary</span>
<span class="c1">#         diary_hhld = [ diary.Diary(t, p.hist_activity, p.hist_local) for p in u.people ]</span>
<span class="c1">#</span>
<span class="c1">#         diary_list.append( diary_hhld )</span>
<span class="c1">#</span>
<span class="c1">#     # &#39;flatten&#39; out the list so that all the diaries are in 1 list</span>
<span class="c1">#     df_list = [ item.df for x in diary_list for item in x]</span>
<span class="c1">#</span>
<span class="c1">#     return df_list</span>

<span class="c1"># def get_ecdf(data):</span>
<span class="c1">#</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     This function creates the empirical cumulative distribution function (ECDF) given data</span>
<span class="c1">#</span>
<span class="c1">#     :param numpy.ndarray data:</span>
<span class="c1">#     :return: the ECDF function</span>
<span class="c1">#</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     ECDF = sm.distributions.ECDF</span>
<span class="c1">#</span>
<span class="c1">#     f = ECDF(data)</span>
<span class="c1">#</span>
<span class="c1">#     return f</span>

<span class="c1"># def get_multi_data(z, fname, N):</span>
<span class="c1">#</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     :param zipfile z: the zipfile of the demographic data</span>
<span class="c1">#     :param str fname:</span>
<span class="c1">#     :return:</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     # the data of the activity of interest</span>
<span class="c1">#     df  = pd.read_csv( z.open(fname) )</span>
<span class="c1">#</span>
<span class="c1">#     # group data by the person identifier</span>
<span class="c1">#     gb  = df.groupby(&#39;PID&#39;)</span>
<span class="c1">#</span>
<span class="c1">#     # the unique person identifiers</span>
<span class="c1">#     pid = df.PID.unique()</span>
<span class="c1">#</span>
<span class="c1">#     # indices (boolean) of entries with only 1 day</span>
<span class="c1">#     idx = np.array( [ len( gb.get_group(x) ) &gt;= N for  x in pid ] )</span>
<span class="c1">#</span>
<span class="c1">#     # the identifiers of only 1 day data</span>
<span class="c1">#     pid_solo = pid[idx]</span>
<span class="c1">#</span>
<span class="c1">#     # returns true if an entry is within pid_solo</span>
<span class="c1">#     f = lambda x: x in pid_solo</span>
<span class="c1">#</span>
<span class="c1">#     # the solo data</span>
<span class="c1">#     # the solo data</span>
<span class="c1">#     result = df[ df.PID.apply(f) ]</span>
<span class="c1">#</span>
<span class="c1">#     return result</span>

<div class="viewcode-block" id="get_solo_data"><a class="viewcode-back" href="../evaluation.html#evaluation.get_solo_data">[docs]</a><span class="k">def</span> <span class="nf">get_solo_data</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function gets the single-day data from individuals with only single-day records \</span>
<span class="sd">     within CHAD.</span>

<span class="sd">    :param zipfile z: the zipfile of the demographic data</span>
<span class="sd">    :param str fname: the file name for the CHAD individual records data</span>

<span class="sd">    :return: the CHAD single-day data</span>
<span class="sd">    :rtype: pandas.core.frame.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># the data of the activity of interest</span>
    <span class="n">df</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">)</span>

    <span class="c1"># group data by the person identifier</span>
    <span class="n">gb</span>  <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;PID&#39;</span><span class="p">)</span>

    <span class="c1"># the unique person identifiers</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">PID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="c1"># indices (boolean) of entries with only 1 day</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="nb">len</span><span class="p">(</span> <span class="n">gb</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span>  <span class="n">x</span> <span class="ow">in</span> <span class="n">pid</span> <span class="p">]</span> <span class="p">)</span>

    <span class="c1"># the identifiers of only 1 day data</span>
    <span class="n">pid_solo</span> <span class="o">=</span> <span class="n">pid</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="c1"># returns true if an entry is within pid_solo</span>
    <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pid_solo</span>

    <span class="c1"># the solo data</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span> <span class="n">df</span><span class="o">.</span><span class="n">PID</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="plot"><a class="viewcode-back" href="../evaluation.html#evaluation.plot">[docs]</a><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">inv_cdf</span><span class="p">,</span> <span class="n">act_code</span><span class="p">,</span> <span class="n">fids</span><span class="p">,</span> <span class="n">do_hours</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots the following results of cumulative distribution function (CDF):</span>

<span class="sd">    #. CDFs comparing the predicted and observed values</span>
<span class="sd">    #. CDFs showing the residual</span>
<span class="sd">    #. CDFs showing the scaled residual</span>
<span class="sd">    #. Inverted CDFs comparing the predicted and observed values</span>
<span class="sd">    #. Inverted CDFs showing the residual</span>
<span class="sd">    #. Inverted CDFs showing the scaled residual</span>

<span class="sd">    :param numpy.ndarray x: the range of values of the data</span>
<span class="sd">    :param numpy.ndarray q: the qunatiles</span>
<span class="sd">    :param numpy.ndarray cdf: the cumulative distribution function in units of percentage</span>
<span class="sd">    :param numpy.ndarray inv_cdf: the cumulative distribution function in units of time</span>
<span class="sd">    :param numpy.ndarray act_code: the activity codes of the respective activities</span>
<span class="sd">    :param numpy.ndarray fids: the figure identifiers</span>
<span class="sd">    :param bool do_hours: a flag indicating whether to plot the inverted CDF data in hours (if True) \</span>
<span class="sd">    or minutes (if false)</span>
<span class="sd">    :param str dname: the name of the data to be plotted</span>
<span class="sd">    :param float off: the percentage in which to put a vertical line indicating both the bottom and top \</span>
<span class="sd">    off-percentage of the data</span>

<span class="sd">    :return: a figure containing CDFs comparing the predicted and observed values, \</span>
<span class="sd">    a figure containing CDFs showing the residual, \</span>
<span class="sd">    a figure containing CDFs showing the scaled residual, \</span>
<span class="sd">    a figure containing Inverted CDFs comparing the predicted and observed values, \</span>
<span class="sd">    a figure containing Inverted CDFs showing the residual, \</span>
<span class="sd">    a figure containing Inverted CDFs showing the scaled residual</span>

<span class="sd">    :rtype: matplotlib.figure.Figure, matplotlib.figure.Figure, matplotlib.figure.Figure \</span>
<span class="sd">    matplotlib.figure.Figure, matplotlib.figure.Figure, matplotlib.figure.Figure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># the amount of minutes in 1 hour</span>
    <span class="n">HOUR_2_MIN</span>  <span class="o">=</span> <span class="n">temporal</span><span class="o">.</span><span class="n">HOUR_2_MIN</span>

    <span class="c1"># the string version of the name</span>
    <span class="n">act_name</span> <span class="o">=</span> <span class="n">activity</span><span class="o">.</span><span class="n">INT_2_STR</span><span class="p">[</span><span class="n">act_code</span><span class="p">]</span>

    <span class="c1"># if no name for the activity name, assign one</span>
    <span class="k">if</span> <span class="n">dname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">act_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">act_name</span><span class="p">,</span> <span class="n">dname</span><span class="p">)</span>

    <span class="c1"># make an iterator for figure identifiers</span>
    <span class="n">fid</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">fids</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># plot the cdf analysis</span>
    <span class="c1">#</span>

    <span class="c1"># plot the CDFs comparing the predicted and observed data</span>
    <span class="n">fig_cdf</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="nb">next</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plot_predicted_observed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cdf</span><span class="o">.</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cdf</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hours&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39; CDF&#39;</span><span class="p">)</span>

    <span class="c1"># plot the residuals of the CDFs that compared the predicted and observed data</span>
    <span class="n">fig_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="nb">next</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plot_residual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cdf</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hours&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39; CDF Residual&#39;</span><span class="p">)</span>

    <span class="c1"># plot the scaled residuals of the CDFs that compared the predicted and observed data</span>
    <span class="n">fig_res_scaled</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">fid</span><span class="p">))</span>
    <span class="n">plot_residual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cdf</span><span class="o">.</span><span class="n">res_scale</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hours&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Standard Deviations&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39; CDF Residual&#39;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># plot the inverse cdf analysis</span>
    <span class="c1">#</span>

    <span class="c1"># make sure the data reflects the wanted units</span>
    <span class="k">if</span> <span class="n">do_hours</span><span class="p">:</span>
        <span class="n">ylabel</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Hours&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylabel</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Minutes&#39;</span><span class="p">,</span> <span class="n">HOUR_2_MIN</span>

    <span class="c1"># plot the CDFs comparing the predicted and observed data</span>
    <span class="n">fig_cdf_inv</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="nb">next</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plot_predicted_observed</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">inv_cdf</span><span class="o">.</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">units</span><span class="p">,</span> <span class="n">inv_cdf</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">units</span><span class="p">,</span>
                            <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Quantile&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39; Inverted CDF&#39;</span><span class="p">)</span>

    <span class="c1"># plot the inverted residuals of the CDFs that compared the predicted and observed data</span>
    <span class="n">fig_res_inv</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="nb">next</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plot_residual</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">inv_cdf</span><span class="o">.</span><span class="n">res</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">units</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Qunatile&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39; Inverted CDF Residual&#39;</span><span class="p">)</span>

    <span class="c1"># plot the inverted scaled residuals of the CDFs that compared the predicted and observed data</span>
    <span class="n">fig_res_inv_scaled</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="nb">next</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">plot_residual</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">inv_cdf</span><span class="o">.</span><span class="n">res_scale</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Qunatile&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Standard Deviations&#39;</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39; Inverted CDF Residual&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_cdf</span><span class="p">,</span> <span class="n">fig_res</span><span class="p">,</span> <span class="n">fig_res_scaled</span><span class="p">,</span> <span class="n">fig_cdf_inv</span><span class="p">,</span> <span class="n">fig_res_inv</span><span class="p">,</span> <span class="n">fig_res_inv_scaled</span></div>


<div class="viewcode-block" id="plot_predicted_observed"><a class="viewcode-back" href="../evaluation.html#evaluation.plot_predicted_observed">[docs]</a><span class="k">def</span> <span class="nf">plot_predicted_observed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the predicted (ABMHAP) and observed (CHAD) data.</span>

<span class="sd">    :param numpy.ndarray x: the x-axis</span>
<span class="sd">    :param numpy.ndarray pred: the predicted (ABMHAP) values</span>
<span class="sd">    :param numpy.ndarray obs: the observed (CHAD) values from data</span>
<span class="sd">    :param str xlabel: the x-axis label</span>
<span class="sd">    :param str ylabel: the y-axis label</span>
<span class="sd">    :param str title: the title of the figure</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># plot the title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># plot the predicated data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ABM&#39;</span><span class="p">)</span>

    <span class="c1"># plot the observed data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>

    <span class="c1"># set the y-axis label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="c1"># set the x-axis label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>

    <span class="c1"># set the legend</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="plot_residual"><a class="viewcode-back" href="../evaluation.html#evaluation.plot_residual">[docs]</a><span class="k">def</span> <span class="nf">plot_residual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residual&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots the residual between cumulative distribution functions (CDFs) \</span>
<span class="sd">    the ABMHAP and CHAD data.</span>

<span class="sd">    :param numpy.ndarray x: the x-axis data</span>
<span class="sd">    :param numpy.ndarray res: the residual :math:`r(x)`</span>
<span class="sd">    :param str xlabel: the x-axis label</span>
<span class="sd">    :param str ylabel: the y-axis label</span>
<span class="sd">    :param str title: the title of the plot</span>
<span class="sd">    :param str color: the color of the plot</span>
<span class="sd">    :param str label: the label of the plot</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># plot the title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># plot the residual data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="c1"># plot the y-axis label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="c1"># plot the x-axis label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>

    <span class="c1"># set the legend</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="residual"><a class="viewcode-back" href="../evaluation.html#evaluation.residual">[docs]</a><span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function analyzes the residual between predicted values and observed values. Given the predicted and \</span>
<span class="sd">    observed values, this function does the following:</span>

<span class="sd">    #. Compute the empirical cumulative distribution function (CDF) between the predicted and observed data \</span>
<span class="sd">    in units [quantile vs hours]</span>
<span class="sd">    #. Compute the residual in the CDF between observed and predicted data</span>

<span class="sd">        .. math::</span>
<span class="sd">            r(x) = cdf_{observed}(x) - cdf_{predicted}(x)</span>

<span class="sd">    #. Invert the residual so that the CDFs and residuals are in units [minutes vs quantile]</span>

<span class="sd">    :param numpy.ndarray pred: the predicted (ABMHAP) values used to make the empirical CDF</span>
<span class="sd">    :param numpy.ndarray obs: the observed (CHAD) values used to make the empirical CDF</span>
<span class="sd">    :param numpy.ndarray x: the x-values</span>
<span class="sd">    :param bool do_scaling: this scales the inverted cdf residual by the standard deviation of the observed values</span>

<span class="sd">    :return: the data for the cumulative distribution data (predicted, observed, residual, and scaled residual), \</span>
<span class="sd">    the data for the inverted cumulative distribution data (predicted, observed, residual, and scaled residual)</span>
<span class="sd">    :rtype: pandas.core.frame.DataFrame, pandas.core.frame.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#</span>
    <span class="c1"># CDF</span>
    <span class="c1">#</span>

    <span class="c1"># smooth probability density functions</span>
    <span class="n">f_obs</span>   <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">f_pred</span>  <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">gaussian_kde</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

    <span class="c1"># the density vectors</span>
    <span class="n">d_obs</span>   <span class="o">=</span> <span class="n">f_obs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">d_pred</span>  <span class="o">=</span> <span class="n">f_pred</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># the cumalative distribution functions</span>
    <span class="n">cdf_obs</span>     <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">d_obs</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cdf_pred</span>    <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">d_pred</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># the residual in the CDFs</span>
    <span class="n">res</span>         <span class="o">=</span> <span class="n">cdf_obs</span> <span class="o">-</span> <span class="n">cdf_pred</span>
    <span class="n">res_scaled</span>  <span class="o">=</span> <span class="n">res</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cdf_obs</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># the inverted CDF</span>
    <span class="c1">#</span>

    <span class="c1"># create functions that represent the inverted cdf</span>
    <span class="n">f_inv_obs</span>   <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cdf_obs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
    <span class="n">f_inv_pred</span>  <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cdf_pred</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># the probability</span>
    <span class="n">p_max</span>   <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="n">cdf_obs</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">cdf_pred</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="p">)</span>
    <span class="n">p</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">p_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">)</span>

    <span class="c1"># the inverted of the CDF</span>
    <span class="n">cdf_inv_obs</span>     <span class="o">=</span> <span class="n">f_inv_obs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">cdf_inv_pred</span>    <span class="o">=</span> <span class="n">f_inv_pred</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">res_inv</span>         <span class="o">=</span> <span class="p">(</span><span class="n">cdf_inv_obs</span> <span class="o">-</span> <span class="n">cdf_inv_pred</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">res_inv_scaled</span>  <span class="o">=</span> <span class="n">res_inv</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Output</span>
    <span class="c1">#</span>

    <span class="c1"># combine all of the information into a data frame</span>
    <span class="n">y_data</span>      <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pred&#39;</span><span class="p">:</span> <span class="n">cdf_pred</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="n">cdf_obs</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">,</span> <span class="s1">&#39;res_scale&#39;</span><span class="p">:</span> <span class="n">res_scaled</span><span class="p">}</span>
    <span class="n">y_inv_data</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pred&#39;</span><span class="p">:</span> <span class="n">cdf_inv_pred</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="n">cdf_inv_obs</span><span class="p">,</span> <span class="s1">&#39;res&#39;</span><span class="p">:</span> <span class="n">res_inv</span><span class="p">,</span> <span class="s1">&#39;res_scale&#39;</span><span class="p">:</span> <span class="n">res_inv_scaled</span><span class="p">}</span>

    <span class="c1"># the cumulative distribution data</span>
    <span class="n">cdf</span>     <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>

    <span class="c1"># the inverted cumulative distribution data</span>
    <span class="n">inv_cdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_inv_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">inv_cdf</span></div>

<div class="viewcode-block" id="residual_analysis"><a class="viewcode-back" href="../evaluation.html#evaluation.residual_analysis">[docs]</a><span class="k">def</span> <span class="nf">residual_analysis</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">do_periodic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function takes the predicted and observed values and computes the respective cumulative distribution \</span>
<span class="sd">    functions (CDFs) in units percentage and the inverted CDF which is the CDF in units of minutes.</span>

<span class="sd">    :param numpy.ndarray pred: the predicted values</span>
<span class="sd">    :param numpy.ndarray obs: the observed values</span>
<span class="sd">    :param int N: the number of points of the CDF vector</span>
<span class="sd">    :param bool do_periodic: a flag to see if the time data should be in a [-12, 12) hour format</span>

<span class="sd">    :return: the x values, CDF of residual, inverted CDF of residual</span>
<span class="sd">    :rtype: numpy.ndarray, pandas.core.frame.DataFrame, pandas.core.frame.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># combine two arrays</span>
    <span class="n">g</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># offset</span>
    <span class="n">off</span> <span class="o">=</span> <span class="mf">15e-1</span>

    <span class="c1"># combine the data</span>
    <span class="n">combo</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>

    <span class="c1"># put the data in [-12, 12) format instead of [0, 24) hour format</span>
    <span class="k">if</span> <span class="n">do_periodic</span><span class="p">:</span>
        <span class="n">combo</span>   <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">to_periodic</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
        <span class="n">pred</span>    <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">to_periodic</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">obs</span>     <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">to_periodic</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="p">)</span>

    <span class="c1"># get the upper and lower bounds of the data</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span> <span class="o">-</span> <span class="n">off</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span> <span class="o">+</span> <span class="n">off</span>

    <span class="c1"># get the x values in the range of the cdfs</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

    <span class="c1"># compute the residual</span>
    <span class="n">cdf</span><span class="p">,</span> <span class="n">inv_cdf</span> <span class="o">=</span> <span class="n">residual</span><span class="p">(</span><span class="n">pred</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">inv_cdf</span></div>

<div class="viewcode-block" id="sample_activity_abm"><a class="viewcode-back" href="../evaluation.html#evaluation.sample_activity_abm">[docs]</a><span class="k">def</span> <span class="nf">sample_activity_abm</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">act</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given an activity type, this function looks at each activity diary and samples 1 event of that activity type \</span>
<span class="sd">    should that diary have a matching activity-entry.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Because the work activity technically occurs twice (1 event before lunch and 1 event after lunch), the \</span>
<span class="sd">        activity needs to be merged as one event in order for the analysis to be correct.</span>

<span class="sd">    :param df_list: the activity diaries</span>
<span class="sd">    :type df_list: list of pandas.core.frame.DataFrame</span>
<span class="sd">    :param float act: the activity code</span>

<span class="sd">    :return: the sampled activities</span>
<span class="sd">    :rtype: pandas.core.frame.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">acts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">:</span>

        <span class="c1"># ignore the last ac</span>
        <span class="c1"># get all of the data frame for the select activity</span>

        <span class="c1"># ignore the first and last entry in the diary</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># get the data for the given activity</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span> <span class="n">data</span><span class="o">.</span><span class="n">act</span> <span class="o">==</span> <span class="n">act</span> <span class="p">]</span>

        <span class="c1"># add activity event data to the list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>

            <span class="c1"># take into account that the work &quot;event&quot; consists of two (or more) work activity-diary entries</span>
            <span class="k">if</span> <span class="n">act</span> <span class="o">==</span> <span class="n">activity</span><span class="o">.</span><span class="n">WORK</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">sample_activitiy_abm_work</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># if there are multiple activities on that day, choose 1 randomly</span>
            <span class="n">acts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>

    <span class="c1"># store all of the results in pandas data frame</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">acts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">diary</span><span class="o">.</span><span class="n">COLNAMES</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">acts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="sample_activitiy_abm_work"><a class="viewcode-back" href="../evaluation.html#evaluation.sample_activitiy_abm_work">[docs]</a><span class="k">def</span> <span class="nf">sample_activitiy_abm_work</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used in order to sample a random day of work activity data from the ABM. This function takes \</span>
<span class="sd">    takes into account that 1 work &quot;event&quot; consists of multiple work activity-diary entries.</span>

<span class="sd">    .. note::</span>
<span class="sd">        This function assumes that df only contains work activity data and is **NOT** empty</span>

<span class="sd">    .. note::</span>
<span class="sd">        The duration data here is the end of the last event - minus the start of the first event. \</span>
<span class="sd">        This is done to mimic how the duration data is stored in CHAD.</span>

<span class="sd">    :param pandas.core.frame.DataFrame df: the diary of work activities for an individual</span>

<span class="sd">    :return:the sampled work data</span>
<span class="sd">    :rtype: pandas.core.frame.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># sample the work activities on a random day</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># get all of the activities in that day</span>
    <span class="n">df_day</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">day</span><span class="p">]</span>

    <span class="c1"># if there is more than 1 activity-entry on the given day</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df_day</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># choose a specific day</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df_day</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># the first event of the day</span>
        <span class="n">x</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">df_day</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>

        <span class="c1"># the last event of the day</span>
        <span class="n">x</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">df_day</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end</span>
        <span class="n">x</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">df_day</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">day</span>

        <span class="c1"># duration is the end of the last event - minus the start of the first event</span>
        <span class="n">x</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">%</span> <span class="mi">24</span>

    <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="save_figs_dt"><a class="viewcode-back" href="../evaluation.html#evaluation.save_figs_dt">[docs]</a><span class="k">def</span> <span class="nf">save_figs_dt</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fpath</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function save plots about the activity duration.</span>

<span class="sd">    :param tuple figs: a tuple of figures to save about activity duration data</span>
<span class="sd">    :param str fpath: the specific file path in which to plot the data</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cdf_dt.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_dt.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_scaled_dt.pkl&#39;</span><span class="p">,</span> \
              <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cdf_inv_dt.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_inv_dt.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_inv_scaled_dt.pkl&#39;</span><span class="p">]</span>

    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[(</span><span class="n">fpath</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">]</span>

    <span class="c1"># save the figures</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fnames</span><span class="p">)</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="save_figs_end"><a class="viewcode-back" href="../evaluation.html#evaluation.save_figs_end">[docs]</a><span class="k">def</span> <span class="nf">save_figs_end</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fpath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function save plots about the activity end time.</span>

<span class="sd">    :param tuple figs: a tuple of figures to save about activity end time data</span>
<span class="sd">    :param str fpath: the specific file path in which to plot the data</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cdf_end.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_end.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_scaled_end.pkl&#39;</span><span class="p">,</span> \
              <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cdf_inv_end.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_inv_end.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_inv_scaled_end.pkl&#39;</span><span class="p">]</span>

    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[(</span><span class="n">fpath</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">]</span>

    <span class="c1"># save the figures</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fnames</span><span class="p">)</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="save_figs_start"><a class="viewcode-back" href="../evaluation.html#evaluation.save_figs_start">[docs]</a><span class="k">def</span> <span class="nf">save_figs_start</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fpath</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function save plots about the activity start time.</span>

<span class="sd">    :param tuple figs: a tuple of figures to save about activity start time data</span>
<span class="sd">    :param str fpath: the specific file path in which to plot the data</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cdf_start.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_start.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_scaled_start.pkl&#39;</span><span class="p">,</span> \
              <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cdf_inv_start.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_inv_start.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">res_inv_scaled_start.pkl&#39;</span><span class="p">]</span>

    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[(</span><span class="n">fpath</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">]</span>

    <span class="c1"># save the figures</span>
    <span class="n">analysis</span><span class="o">.</span><span class="n">save_figures</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">fnames</span><span class="p">)</span>

    <span class="k">return</span></div>

<div class="viewcode-block" id="save_figures"><a class="viewcode-back" href="../evaluation.html#evaluation.save_figures">[docs]</a><span class="k">def</span> <span class="nf">save_figures</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">figs_start</span><span class="p">,</span> <span class="n">figs_end</span><span class="p">,</span> <span class="n">figs_dt</span><span class="p">,</span> <span class="n">fpath</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function saves the plotted figures about duration and start time data of the results from \</span>
<span class="sd">    :func:`compare_abm_to_chad`.</span>

<span class="sd">    :param int act: the activity code</span>
<span class="sd">    :param tuple figs_start: a tuple of figures to save about activity start time data about the random day sampling</span>
<span class="sd">    :param tuple figs_end: a tuple of figures to save about activity end time data about the random day sampling</span>
<span class="sd">    :param tuple figs_dt: a tuple of figures to save about activity duration data about the random day sampling</span>
<span class="sd">    :param str fpath: the general file path to plot the data</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># plot the results of the</span>
    <span class="n">fpath_new</span> <span class="o">=</span> <span class="n">fpath</span> <span class="o">+</span> <span class="n">mg</span><span class="o">.</span><span class="n">KEY_2_FDIR_SAVE_FIG</span><span class="p">[</span><span class="n">act</span><span class="p">]</span> <span class="o">+</span> <span class="n">mg</span><span class="o">.</span><span class="n">FDIR_SAVE_FIG_RANDOM_DAY</span>

    <span class="c1"># save the duration and start time data, respectively</span>
    <span class="n">save_figs_start</span><span class="p">(</span><span class="n">figs_start</span><span class="p">,</span> <span class="n">fpath_new</span><span class="p">)</span>
    <span class="n">save_figs_end</span><span class="p">(</span><span class="n">figs_end</span><span class="p">,</span> <span class="n">fpath_new</span><span class="p">)</span>
    <span class="n">save_figs_dt</span><span class="p">(</span><span class="n">figs_dt</span><span class="p">,</span> <span class="n">fpath_new</span><span class="p">)</span>

    <span class="k">return</span></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Namdi Brandon.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>