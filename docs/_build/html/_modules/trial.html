
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>trial &#8212; ABMHAP 2018.06 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for trial</h1><div class="highlight"><pre>
<span></span><span class="c1"># The United States Environmental Protection Agency through its Office of</span>
<span class="c1"># Research and Development has developed this software. The code is made</span>
<span class="c1"># publicly available to better communicate the research. All input data</span>
<span class="c1"># used fora given application should be reviewed by the researcher so</span>
<span class="c1"># that the model results are based on appropriate data for any given</span>
<span class="c1"># application. This model is under continued development. The model and</span>
<span class="c1"># data included herein do not represent and should not be construed to</span>
<span class="c1"># represent any Agency determination or policy.</span>
<span class="c1">#</span>
<span class="c1"># This file was written by Dr. Namdi Brandon</span>
<span class="c1"># ORCID: 0000-0001-7050-1538</span>
<span class="c1"># March 22, 2018</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is the module that is in charge of running simulations comparing the Agent-Based Model of \</span>
<span class="sd">Human Activity Patterns (ABMHAP) with the data from the Consolidated Human Activity Database \</span>
<span class="sd">(CHAD).</span>

<span class="sd">This module contains the class :class:`trial.Trial`.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ===========================================</span>
<span class="c1"># import</span>
<span class="c1"># ===========================================</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">source&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">run&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;..</span><span class="se">\\</span><span class="s1">processing&#39;</span><span class="p">)</span>

<span class="c1"># mathematical capability</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># dataframe capability</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># zipfile capability</span>
<span class="kn">import</span> <span class="nn">zipfile</span>

<span class="c1"># ABMHAP modules</span>
<span class="kn">import</span> <span class="nn">my_globals</span> <span class="k">as</span> <span class="nn">mg</span>
<span class="kn">import</span> <span class="nn">activity</span><span class="o">,</span> <span class="nn">chad</span><span class="o">,</span> <span class="nn">diary</span><span class="o">,</span> <span class="nn">location</span><span class="o">,</span> <span class="nn">singleton</span><span class="o">,</span> <span class="nn">state</span><span class="o">,</span> <span class="nn">universe</span>

<span class="c1"># ===========================================</span>
<span class="c1"># constants</span>
<span class="c1"># ===========================================</span>
<span class="n">NO_TRIAL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>

<span class="n">SLEEP</span>               <span class="o">=</span> <span class="mi">1</span>
<span class="n">WORK</span>                <span class="o">=</span> <span class="mi">2</span>
<span class="n">COMMUTE_TO_WORK</span>     <span class="o">=</span> <span class="mi">3</span>
<span class="n">COMMUTE_FROM_WORK</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">EAT_BREAKFAST</span>       <span class="o">=</span> <span class="mi">5</span>
<span class="n">EAT_LUNCH</span>           <span class="o">=</span> <span class="mi">6</span>
<span class="n">EAT_DINNER</span>          <span class="o">=</span> <span class="mi">7</span>
<span class="n">OMNI</span>                <span class="o">=</span> <span class="mi">1000</span>

<span class="c1">#</span>
<span class="c1"># coefficient of variation. This avoids negative numbers for sampling duration</span>
<span class="c1">#</span>
<span class="c1"># the minimum amount of time for an event duration will be considered long [hours]</span>
<span class="n">LONG_DURATION</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># maximum coefficient of variation</span>
<span class="n">CV_MIN</span>  <span class="o">=</span> <span class="mf">0.10</span>
<span class="n">CV_MAX</span>  <span class="o">=</span> <span class="mf">0.80</span>

<span class="n">CV_SHORT</span>   <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">CV_LONG</span>    <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># represent the integer identifier as a string</span>
<span class="n">INT_2_STR</span> <span class="o">=</span> <span class="p">{</span> <span class="n">NO_TRIAL</span><span class="p">:</span> <span class="s1">&#39;No trial&#39;</span><span class="p">,</span> <span class="n">SLEEP</span><span class="p">:</span> <span class="s1">&#39;sleep trial&#39;</span><span class="p">,</span> <span class="n">WORK</span><span class="p">:</span> <span class="s1">&#39;work trial&#39;</span><span class="p">,</span>
              <span class="n">COMMUTE_TO_WORK</span><span class="p">:</span> <span class="s1">&#39;commute to work trial&#39;</span><span class="p">,</span> <span class="n">COMMUTE_FROM_WORK</span><span class="p">:</span> <span class="s1">&#39;commute from work trial&#39;</span><span class="p">,</span>
              <span class="n">EAT_BREAKFAST</span><span class="p">:</span> <span class="s1">&#39;eat breakfast trial&#39;</span><span class="p">,</span> <span class="n">EAT_LUNCH</span><span class="p">:</span> <span class="s1">&#39;eat lunch trial&#39;</span><span class="p">,</span> <span class="n">EAT_DINNER</span><span class="p">:</span> <span class="s1">&#39;eat dinner trial&#39;</span><span class="p">}</span>

<span class="c1"># represent the string identifier as an integer</span>
<span class="n">STR_2_INT</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">INT_2_STR</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>

<span class="c1"># indicates which activities are in the OMNI trial</span>
<span class="n">OMNI_ACTIVITIES</span> <span class="o">=</span> <span class="p">[</span><span class="n">activity</span><span class="o">.</span><span class="n">COMMUTE_TO_WORK</span><span class="p">,</span> <span class="n">activity</span><span class="o">.</span><span class="n">COMMUTE_FROM_WORK</span><span class="p">,</span> <span class="n">activity</span><span class="o">.</span><span class="n">EAT_BREAKFAST</span><span class="p">,</span> \
                   <span class="n">activity</span><span class="o">.</span><span class="n">EAT_DINNER</span><span class="p">,</span> <span class="n">activity</span><span class="o">.</span><span class="n">EAT_LUNCH</span><span class="p">,</span> <span class="n">activity</span><span class="o">.</span><span class="n">SLEEP</span><span class="p">,</span> <span class="n">activity</span><span class="o">.</span><span class="n">WORK</span><span class="p">]</span>

<span class="c1"># indicates which activities are contained in each trial.</span>
<span class="c1"># Note: each value in the dictionary is a list</span>
<span class="n">TRIAL_2_ACTIVITY</span> <span class="o">=</span> <span class="p">{</span><span class="n">COMMUTE_TO_WORK</span><span class="p">:</span> <span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">COMMUTE_TO_WORK</span><span class="p">,),</span>
           <span class="n">COMMUTE_FROM_WORK</span><span class="p">:</span> <span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">COMMUTE_FROM_WORK</span><span class="p">,),</span>
           <span class="n">EAT_BREAKFAST</span><span class="p">:</span> <span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">EAT_BREAKFAST</span><span class="p">,),</span>
           <span class="n">EAT_DINNER</span><span class="p">:</span> <span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">EAT_DINNER</span><span class="p">,),</span>
           <span class="n">EAT_LUNCH</span><span class="p">:</span> <span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">EAT_LUNCH</span><span class="p">,),</span>
           <span class="n">SLEEP</span><span class="p">:</span> <span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">SLEEP</span><span class="p">,),</span>
           <span class="n">WORK</span><span class="p">:</span> <span class="p">(</span><span class="n">activity</span><span class="o">.</span><span class="n">WORK</span><span class="p">,),</span>
           <span class="n">OMNI</span><span class="p">:</span> <span class="n">OMNI_ACTIVITIES</span><span class="p">,</span>
           <span class="p">}</span>

<span class="c1"># ===========================================</span>
<span class="c1"># class Trial</span>
<span class="c1"># ===========================================</span>

<div class="viewcode-block" id="Trial"><a class="viewcode-back" href="../trial.html#trial.Trial">[docs]</a><span class="k">class</span> <span class="nc">Trial</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is sets up runs for the ABMHAP initialized with data from CHAD.</span>

<span class="sd">    This is how to run a trial</span>

<span class="sd">    #. create the Trial object via __init__()</span>
<span class="sd">    #. initialize the Trial. That is, one must set up the distribution for sampling means and standard deviations) \</span>
<span class="sd">     via initialize(). This is usually done by sending the appropriate files names to the function for the respective \</span>
<span class="sd">     distributions.</span>
<span class="sd">    #. create the universe for the simulation</span>
<span class="sd">    #. add the people to the household</span>
<span class="sd">    #. run the simulation</span>

<span class="sd">    :param params.Params params: the parameters that describe the household</span>
<span class="sd">    :param chad_params.CHAD_params sampling_params: the sampling parameters used to filter &quot;good&quot; CHAD activity data</span>
<span class="sd">    :param int demographic: the demographic identifier used to parametrize the agent</span>

<span class="sd">    :var int id: the trial identifier</span>
<span class="sd">    :var params.Params &#39;params&#39;: the parameters that describe the household</span>
<span class="sd">    :var chad_params.CHAD_params sampling_params: the sampling parameters used to filter &quot;good&quot; CHAD data</span>
<span class="sd">    :var int num_samples: the number of ABMHAP samples (or trials) to be run</span>
<span class="sd">    :var int demographic: the demographic identifier used to parametrize the agent</span>
<span class="sd">    :var str fname: the name of the zipfile for the CHAD data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">sampling_params</span><span class="p">,</span> <span class="n">demographic</span><span class="p">):</span>


        <span class="c1"># the identifier for the trial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">NO_TRIAL</span>

        <span class="c1"># number of samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_samples</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># relevant ABM parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">parameters</span>

        <span class="c1"># relevant CHAD activity parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampling_params</span> <span class="o">=</span> <span class="n">sampling_params</span>

        <span class="c1"># name of the zipfile for the CHAD stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># the demographic identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">demographic</span> <span class="o">=</span> <span class="n">demographic</span>

        <span class="k">return</span>

<div class="viewcode-block" id="Trial.add_person_to_universe"><a class="viewcode-back" href="../trial.html#trial.Trial.add_person_to_universe">[docs]</a>    <span class="k">def</span> <span class="nf">add_person_to_universe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates a person and sets up the universe for simulation.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This function currently only assumes that each simulation has only 1 person / household. \</span>
<span class="sd">            This will need to be changed later. There will be conflicts with the idx and id.</span>

<span class="sd">        :param universe.Universe u: the universe the simulation will run in</span>
<span class="sd">        :param int idx: the index for :attr:`params` to access to parametrize this person.</span>

<span class="sd">        :return u: the updated/ initialized universe</span>
<span class="sd">        :rtype: universe.Universe</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize / create the person</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_person</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

        <span class="c1"># person identifier number</span>
        <span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">idx</span>

        <span class="c1"># add person to the universe</span>
        <span class="n">u</span><span class="o">.</span><span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># set the agent&#39;s state to be in the initial state</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">people</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">is_init</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># initialize the needs</span>
        <span class="n">u</span><span class="o">.</span><span class="n">initialize_needs</span><span class="p">()</span>

        <span class="c1"># initialize the home assets</span>
        <span class="n">u</span><span class="o">.</span><span class="n">home</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">people</span><span class="p">)</span>

        <span class="c1"># set the home economics</span>
        <span class="n">u</span><span class="o">.</span><span class="n">home</span><span class="o">.</span><span class="n">set_revenue</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">people</span><span class="p">)</span>

        <span class="c1"># set the population</span>
        <span class="n">u</span><span class="o">.</span><span class="n">home</span><span class="o">.</span><span class="n">set_population</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">people</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="Trial.assign_chad_params"><a class="viewcode-back" href="../trial.html#trial.Trial.assign_chad_params">[docs]</a>    <span class="k">def</span> <span class="nf">assign_chad_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">f_stats</span><span class="p">,</span> <span class="n">s_params</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign the CHAD statistical parameters for a given activity to the agent.</span>

<span class="sd">        :param zipfile.ZipFile z: the file name (.zip) for the demographic data</span>
<span class="sd">        :param f_stats: the file names of the statistical data relevant to the start time, \</span>
<span class="sd">        end time, duration, and CHAD records for a given activity</span>
<span class="sd">        :type f_stats: a dictionary of int - str</span>
<span class="sd">        :param chad_params.CHAD_params s_params: the parameters that limit the sampling of \</span>
<span class="sd">        respective statistical data</span>

<span class="sd">        :return: relevant parameters for each person in the household for \</span>
<span class="sd">        a given activity. The tuple contains the following [in hours]: mean start time, standard \</span>
<span class="sd">        deviation of start time, mean end time, standard deviation of end time, mean duration, \</span>
<span class="sd">        and standard deviation of duration for each person in the household.</span>
<span class="sd">        :rtype data: tuple of numpy.ndarray, numpy.ndarray, numpy.ndarray, \</span>
<span class="sd">        numpy.ndarray, numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f_stats</span><span class="p">,</span> <span class="n">s_params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="Trial.check_spacing"><a class="viewcode-back" href="../trial.html#trial.Trial.check_spacing">[docs]</a>    <span class="k">def</span> <span class="nf">check_spacing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is done to make sure the minimum end time does not overlap with plausible start times. The \</span>
<span class="sd">        function returns the indices of agents with a parametrization that causes this overlap. This is \</span>
<span class="sd">        a concern for activities like sleeping where the agent can be assigned to end too early after \</span>
<span class="sd">        starting the sleep too quickly.</span>

<span class="sd">        :param numpy.ndarray start_mean: the mean start time for the given activity for each person \</span>
<span class="sd">        in the household</span>
<span class="sd">        :param numpy.ndarray start_std: the standard deviation of start time for the given activity \</span>
<span class="sd">        for each person in the household</span>
<span class="sd">        :param numpy.ndarray end_mean: the mean end time for the given activity for each person in \</span>
<span class="sd">        the household</span>
<span class="sd">        :param numpy.ndarray end_std: the standard deviation of end time for the given activity for \</span>
<span class="sd">        each person in the household</span>
<span class="sd">        :param float spacing: the minimum amount</span>

<span class="sd">        :return: the indices of the agents with improper parametrization</span>
<span class="sd">        :rtype: numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the amount of hours to 1 day</span>
        <span class="n">DAY_2_HOUR</span>  <span class="o">=</span> <span class="mi">24</span>

        <span class="c1"># the maximum allowed value for start time, assuming 1 standard deviation</span>
        <span class="n">start_max</span>   <span class="o">=</span> <span class="p">(</span><span class="n">start_mean</span> <span class="o">+</span> <span class="n">start_std</span><span class="p">)</span> <span class="o">%</span> <span class="n">DAY_2_HOUR</span>

        <span class="c1"># the minimum allowed value for end time, assuming 1 standard deviation</span>
        <span class="n">end_min</span>     <span class="o">=</span> <span class="p">(</span><span class="n">end_mean</span> <span class="o">-</span> <span class="n">end_std</span><span class="p">)</span> <span class="o">%</span> <span class="n">DAY_2_HOUR</span>

        <span class="c1"># if there is too much overlap (i.e., if the minimum end time overlaps the maximum start time, the</span>
        <span class="c1"># parametrization is seen as bad</span>
        <span class="n">gap</span>         <span class="o">=</span> <span class="p">(</span><span class="n">start_max</span> <span class="o">-</span> <span class="n">end_min</span><span class="p">)</span> <span class="o">%</span> <span class="n">DAY_2_HOUR</span>
        <span class="n">idx</span>         <span class="o">=</span> <span class="n">gap</span> <span class="o">&lt;=</span> <span class="n">spacing</span>

        <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="Trial.create_universe"><a class="viewcode-back" href="../trial.html#trial.Trial.create_universe">[docs]</a>    <span class="k">def</span> <span class="nf">create_universe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates a universe object that simulations will run in.</span>

<span class="sd">        :return u: the universe for the simulation to run in</span>
<span class="sd">        :rtype: universe.Universe</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># set up universe</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">num_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">t_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">num_people</span><span class="p">)</span>

        <span class="c1"># set the clock to the desired start time</span>
        <span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">t_univ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">t_start</span>
        <span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">set_time</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">u</span></div>

<div class="viewcode-block" id="Trial.get_chad_stats_data_dt"><a class="viewcode-back" href="../trial.html#trial.Trial.get_chad_stats_data_dt">[docs]</a>    <span class="k">def</span> <span class="nf">get_chad_stats_data_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">s_params</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function obtains the CHAD data for activity duration data that are \</span>
<span class="sd">        suitable for ABMHAP simulation.</span>

<span class="sd">        :param zifpile.Zipfile z: the zipfile of the activity data</span>
<span class="sd">        :param str fname: the file name for the data file for activity duration</span>
<span class="sd">        :param chad_params.CHAD_params s_params: the parameters that limit the sampling of \</span>
<span class="sd">        respective statistical data for a given activity</span>

<span class="sd">        :return: the CHAD data for activity duration suitable for ABMHAP simulation</span>
<span class="sd">        :rtype: pandas.core.frame.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the data from CHAD to limit duration</span>
        <span class="n">data</span>    <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span> <span class="p">(</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># get the duration data</span>
        <span class="n">dt</span>      <span class="o">=</span> <span class="n">s_params</span><span class="o">.</span><span class="n">get_dt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;PID&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">dt</span></div>

<div class="viewcode-block" id="Trial.get_chad_stats_data_end"><a class="viewcode-back" href="../trial.html#trial.Trial.get_chad_stats_data_end">[docs]</a>    <span class="k">def</span> <span class="nf">get_chad_stats_data_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">s_params</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function obtains the CHAD data for activity end time data that are \</span>
<span class="sd">        suitable for ABMHAP simulation.</span>

<span class="sd">        :param zifpile.Zipfile z: the zipfile of the activity data</span>
<span class="sd">        :param str fname: the file name for the data file for activity duration</span>
<span class="sd">        :param chad_params.CHAD_params s_params: the parameters that limit the sampling of \</span>
<span class="sd">        respective statistical data for a given activity</span>

<span class="sd">        :return: the CHAD data for activity end time suitable for ABMHAP simulation</span>
<span class="sd">        :rtype: pandas.core.frame.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the data from CHAD to limit end time</span>
        <span class="n">data</span>    <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span> <span class="p">(</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># get end time</span>
        <span class="n">end</span>     <span class="o">=</span> <span class="n">s_params</span><span class="o">.</span><span class="n">get_end</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;PID&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">end</span></div>

    <span class="c1"># def get_chad_stats_data_same_day(self, z, f_stats, s_params):</span>
    <span class="c1">#</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This function obtains the CHAD data for activity duration data that are \</span>
    <span class="c1">#     suitable for ABMHAP simulation.</span>
    <span class="c1">#</span>
    <span class="c1">#     :param zifpile.Zipfile z: the zipfile of the activity data</span>
    <span class="c1">#     :param str fname: the file name for the data file for activity duration</span>
    <span class="c1">#     :param chad_params.CHAD_params s_params: the parameters that limit the sampling of \</span>
    <span class="c1">#     respective statistical data for a given activity</span>
    <span class="c1">#</span>
    <span class="c1">#     :return: the CHAD data for activity duration suitable for ABMHAP simulation</span>
    <span class="c1">#     :rtype: pandas.core.frame.DataFrame</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     # get the file names</span>
    <span class="c1">#     fname_dt, fname_start = f_stats</span>
    <span class="c1">#</span>
    <span class="c1">#     df_dt, df_start = self.get_chad_stats_data(z, fname_dt, fname_start, s_params)</span>
    <span class="c1">#</span>
    <span class="c1">#     # sample the the each moment independently for each Person in the simulation</span>
    <span class="c1">#     dt_mean, dt_std, start_mean, start_std = self.sample(df_dt, df_start)</span>
    <span class="c1">#</span>
    <span class="c1">#     # set duration of standard deviations to zero</span>
    <span class="c1">#     dt_std      = np.zeros(dt_std.shape)</span>
    <span class="c1">#</span>
    <span class="c1">#     # set start time of standard deviations to zero</span>
    <span class="c1">#     start_std   = np.zeros(start_std.shape)</span>
    <span class="c1">#</span>
    <span class="c1">#     # store the moments for the respective activity</span>
    <span class="c1">#     x = (dt_mean, dt_std, start_mean, start_std)</span>
    <span class="c1">#</span>
    <span class="c1">#     return x</span>

<div class="viewcode-block" id="Trial.get_chad_stats_data_start"><a class="viewcode-back" href="../trial.html#trial.Trial.get_chad_stats_data_start">[docs]</a>    <span class="k">def</span> <span class="nf">get_chad_stats_data_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">s_params</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function obtains the CHAD data for activity start time data that are \</span>
<span class="sd">        suitable for ABMHAP simulation.</span>

<span class="sd">        :param zifpile.Zipfile z: the zipfile of the activity data</span>
<span class="sd">        :param str fname: the file name for the data file for activity duration</span>
<span class="sd">        :param chad_params.CHAD_params s_params: the parameters that limit the sampling of \</span>
<span class="sd">        respective statistical data for a given activity</span>

<span class="sd">        :return: the CHAD data for activity duration suitable for ABMHAP simulation</span>
<span class="sd">        :rtype: pandas.core.frame.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get the data from CHAD to limit start time</span>
        <span class="n">data</span>    <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span> <span class="p">(</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># get the start time</span>
        <span class="n">start</span>   <span class="o">=</span> <span class="n">s_params</span><span class="o">.</span><span class="n">get_start</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;PID&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">start</span></div>

<div class="viewcode-block" id="Trial.get_diary"><a class="viewcode-back" href="../trial.html#trial.Trial.get_diary">[docs]</a>    <span class="k">def</span> <span class="nf">get_diary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes the simulation data in terms of a list of \</span>
<span class="sd">        :class:`universe.Universe` and creates a list \</span>
<span class="sd">        of :class:`diary.Diary` that contain the activity diaries. \</span>
<span class="sd">        One per each household in the simulation.</span>

<span class="sd">        :param universe.Universe u: contains all of the simulation data</span>
<span class="sd">        :return: the activity diaries (1 entry per person)</span>
<span class="sd">        :rtype: list of :class:`diary.Diary`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the list of diaries for each agent in the household</span>
        <span class="n">diary_hhld</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># the household diaries for each agent in the simulation</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">people</span><span class="p">:</span>

            <span class="c1"># get the information about the diary</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">act</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_diary_help</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">hist_time</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">hist_activity</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">hist_local</span><span class="p">)</span>

            <span class="c1"># add the diary to the list</span>
            <span class="n">diary_hhld</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">diary</span><span class="o">.</span><span class="n">Diary</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">act</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">diary_hhld</span></div>

<div class="viewcode-block" id="Trial.get_diary_help"><a class="viewcode-back" href="../trial.html#trial.Trial.get_diary_help">[docs]</a>    <span class="k">def</span> <span class="nf">get_diary_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">hist_act</span><span class="p">,</span> <span class="n">hist_loc</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes data on the activity start times, activity codes, and location codes \</span>
<span class="sd">        from an activity diary and fills out the activity, minute-by-minute in between two adjacent \</span>
<span class="sd">        activities.</span>

<span class="sd">        :param numpy.ndarray t: the start time from an activity diary</span>
<span class="sd">        :param numpy.ndarray hist_act: the activity codes from an activity diary</span>
<span class="sd">        :param numpy.ndarray hist_loc: the location codes from an activity diary</span>

<span class="sd">        :return: the minute by minute information from an ABMHAP simulation for the \</span>
<span class="sd">        following: time information, activity codes, and location codes</span>
<span class="sd">        :rtype: numpy.ndarray, numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get indices that indicate the simulation data</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">t</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># start times of the simulation only</span>
        <span class="n">t_data</span>      <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># activity codes of the simulation only</span>
        <span class="n">act_data</span>    <span class="o">=</span> <span class="n">hist_act</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># location codes of the simulation only</span>
        <span class="n">loc_data</span>    <span class="o">=</span> <span class="n">hist_loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># the minute by minute time information for the simulation</span>
        <span class="n">t_all</span>       <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">fill_out_time</span><span class="p">(</span><span class="n">t_data</span><span class="p">)</span>

        <span class="c1"># the minute by minute activity code information for the simulation</span>
        <span class="n">act_all</span>     <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">fill_out_data</span><span class="p">(</span><span class="n">t_data</span><span class="p">,</span> <span class="n">act_data</span><span class="p">)</span>

        <span class="c1"># the minute by minute location code information for the simulation</span>
        <span class="n">loc_all</span>     <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">fill_out_data</span><span class="p">(</span><span class="n">t_data</span><span class="p">,</span> <span class="n">loc_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t_all</span><span class="p">,</span> <span class="n">act_all</span><span class="p">,</span> <span class="n">loc_all</span></div>

    <span class="c1"># def get_moments(self, fname_dt, fname_start):</span>
    <span class="c1">#</span>
    <span class="c1">#     # get the moments of CHAD data for activity duration and activity start time, respectively</span>
    <span class="c1">#     chad_df_dt, chad_df_start = self.get_chad_stats_data(self.fname, fname_dt=fname_dt, fname_start=fname_start)</span>
    <span class="c1">#</span>
    <span class="c1">#     # sample the the each moment independently for each Person in the ABM simulation</span>
    <span class="c1">#     abm_dt_mean, abm_dt_std, abm_start_mean, abm_start_std = self.sample(chad_df_dt, chad_df_start)</span>
    <span class="c1">#</span>
    <span class="c1">#     return chad_df_dt, chad_df_start, abm_dt_mean, abm_dt_std, abm_start_mean, abm_start_std</span>

<div class="viewcode-block" id="Trial.get_stats_data"><a class="viewcode-back" href="../trial.html#trial.Trial.get_stats_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">f_stats</span><span class="p">,</span> <span class="n">s_params</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign the CHAD statistical parameters for a given activity to the agent.</span>

<span class="sd">        :param zipfile.ZipFile z: the file name (.zip) for the demographic data</span>
<span class="sd">        :param f_stats: the file names of the statistical data relevant to the start time, \</span>
<span class="sd">        end time, duration, and CHAD records for a given activity</span>
<span class="sd">        :type f_stats: a dictionary of int - str</span>
<span class="sd">        :param chad_params.CHAD_params s_params: the parameters that limit the sampling of \</span>
<span class="sd">        respective statistical data</span>

<span class="sd">        :return: relevant parameters for each person in the household for \</span>
<span class="sd">        a given activity. The tuple contains the following [in hours]: mean start time, standard \</span>
<span class="sd">        deviation of start time, mean end time, standard deviation of end time, mean duration, \</span>
<span class="sd">        and standard deviation of duration for each person in the household.</span>
<span class="sd">        :rtype data: tuple of numpy.ndarray, numpy.ndarray, numpy.ndarray, \</span>
<span class="sd">        numpy.ndarray, numpy.ndarray, numpy.ndarray</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># number of people per household</span>
        <span class="n">N</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">num_people</span>

        <span class="c1"># the file name for the start time, end time, and duration for a given activity</span>
        <span class="n">fname_start</span><span class="p">,</span> <span class="n">fname_end</span><span class="p">,</span> <span class="n">fname_dt</span> <span class="o">=</span> <span class="n">f_stats</span><span class="p">[</span><span class="n">chad</span><span class="o">.</span><span class="n">START</span><span class="p">],</span> <span class="n">f_stats</span><span class="p">[</span><span class="n">chad</span><span class="o">.</span><span class="n">END</span><span class="p">],</span> <span class="n">f_stats</span><span class="p">[</span><span class="n">chad</span><span class="o">.</span><span class="n">DT</span><span class="p">]</span>

        <span class="c1"># time is in hours[0, 24)</span>

        <span class="c1"># initialize duration mean and standard deviation values, respectively, to zero</span>
        <span class="n">dt_mean</span><span class="p">,</span> <span class="n">dt_std</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="c1"># initialize start time mean and standard deviation values, respectively, to zero</span>
        <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="c1"># initialize end time mean and standard deviation values, respectively, to zero</span>
        <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># duration</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">s_params</span><span class="o">.</span><span class="n">do_dt</span><span class="p">:</span>

            <span class="c1"># sample duration data from CHAD</span>
            <span class="n">df_dt</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chad_stats_data_dt</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fname_dt</span><span class="p">,</span> <span class="n">s_params</span><span class="p">)</span>

            <span class="c1"># sample mean and standard deviation duration data based on the empirical</span>
            <span class="c1"># data distributions for the agent</span>
            <span class="n">dt_mean</span><span class="p">,</span> <span class="n">dt_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_dt</span><span class="p">(</span><span class="n">df_dt</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">s_params</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># both start and end time</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">s_params</span><span class="o">.</span><span class="n">do_start</span> <span class="ow">and</span> <span class="n">s_params</span><span class="o">.</span><span class="n">do_end</span><span class="p">:</span>

            <span class="c1"># sample start time data from CHAD</span>
            <span class="n">df_start</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chad_stats_data_start</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fname_start</span><span class="p">,</span> <span class="n">s_params</span><span class="p">)</span>

            <span class="c1"># sample end time data from CHAD</span>
            <span class="n">df_end</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chad_stats_data_end</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fname_end</span><span class="p">,</span> <span class="n">s_params</span><span class="p">)</span>

            <span class="c1"># sample mean and standard deviation start time and end time data based</span>
            <span class="c1"># on the empirical data distributions for the agent</span>
            <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_start_end</span><span class="p">(</span><span class="n">df_start</span><span class="p">,</span> <span class="n">df_end</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">s_params</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1">#</span>
            <span class="c1"># start time only</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">s_params</span><span class="o">.</span><span class="n">do_start</span><span class="p">:</span>

                <span class="c1"># sample start time data from CHAD</span>
                <span class="n">df_start</span>                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chad_stats_data_start</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fname_start</span><span class="p">,</span> <span class="n">s_params</span><span class="p">)</span>

                <span class="c1"># sample mean and standard deviation start time data based on the empirical data</span>
                <span class="c1"># distributions for the agent</span>
                <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_help</span><span class="p">(</span><span class="n">df_start</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">s_params</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

            <span class="c1">#</span>
            <span class="c1"># end time only</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">s_params</span><span class="o">.</span><span class="n">do_end</span><span class="p">:</span>

                <span class="c1"># sample end time data from CHAD</span>
                <span class="n">df_end</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_chad_stats_data_end</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fname_end</span><span class="p">,</span> <span class="n">s_params</span><span class="p">)</span>

                <span class="c1"># sample mean and standard deviation end time data based on the empirical data</span>
                <span class="c1"># distributions for the agent</span>
                <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_help</span><span class="p">(</span><span class="n">df_end</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">s_params</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

        <span class="c1"># store the moments for the respective activity [time is expressed in hours]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span><span class="p">,</span> <span class="n">dt_mean</span><span class="p">,</span> <span class="n">dt_std</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Trial.get_stats_data_dt"><a class="viewcode-back" href="../trial.html#trial.Trial.get_stats_data_dt">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats_data_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">n_data</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function samples the duration data from CHAD from a particular activity and \</span>
<span class="sd">        gets the mean and standard deviation of duration for the respective activity \</span>
<span class="sd">        for each person in the household.</span>

<span class="sd">        :param pandas.core.frame.DataFrame df: duration CHAD data</span>
<span class="sd">        :param int num_people: the number of people in the household</span>
<span class="sd">        :param int n_data: the minimum number of data points per \</span>
<span class="sd">        CHAD-person record used in sampling the CHAD data</span>

<span class="sd">        :return: the mean and standard deviation [in hours] for a given activity for \</span>
<span class="sd">        each person in the household</span>
<span class="sd">        :rtype: numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get a list of values that represent the empirical distribution of the mean, standard deviation, and \</span>
        <span class="c1"># coefficient of variation</span>
        <span class="n">x_mean</span><span class="p">,</span> <span class="n">x_std</span><span class="p">,</span> <span class="n">x_cv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># keep the distribution of mean values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_mean</span><span class="p">)</span>

        <span class="c1"># randomly assign N values for the mean of duration</span>
        <span class="n">x_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x_mean</span><span class="p">,</span> <span class="n">num_people</span><span class="p">)</span>

        <span class="c1"># assign a coefficient of duration and then use it in assigning a standard deviation for</span>
        <span class="c1"># the duration</span>
        <span class="k">if</span> <span class="n">n_data</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">LONG_DURATION</span><span class="p">:</span>
                <span class="n">cv</span>  <span class="o">=</span> <span class="n">CV_LONG</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cv</span>  <span class="o">=</span> <span class="n">CV_SHORT</span>

            <span class="c1"># assign the N calues of standard deviation for duration</span>
            <span class="n">x_std</span>   <span class="o">=</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">x_mean</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># want to get values between a low and a high</span>
            <span class="n">x_cv</span>    <span class="o">=</span> <span class="n">x_cv</span><span class="p">[(</span><span class="n">x_cv</span> <span class="o">&gt;=</span> <span class="n">CV_MIN</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_cv</span> <span class="o">&lt;=</span> <span class="n">CV_MAX</span><span class="p">)]</span>

            <span class="c1"># randomly assign N values for the coefficient of variation for duration</span>
            <span class="n">x_cv</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x_cv</span><span class="p">,</span> <span class="n">num_people</span><span class="p">)</span>

            <span class="c1"># assign the N values of standard deviation for duration</span>
            <span class="n">x_std</span>   <span class="o">=</span> <span class="n">x_cv</span> <span class="o">*</span> <span class="n">x_mean</span>

        <span class="k">return</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">x_std</span></div>

<div class="viewcode-block" id="Trial.get_stats_data_help"><a class="viewcode-back" href="../trial.html#trial.Trial.get_stats_data_help">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats_data_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">n_data</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function samples the CHAD data to obtain information \</span>
<span class="sd">        on the mean and standard deviation data. This is done by doing \</span>
<span class="sd">        the following</span>

<span class="sd">        #. creating an empirical distribution for the mean and standard deviation of the data</span>
<span class="sd">        #. randomly choosing a value out of the distribution for each agent in the household</span>

<span class="sd">        :param pandas.core.frame.DataFrame df: the CHAD statistical data</span>
<span class="sd">        :param int num_people: number of people in the household</span>
<span class="sd">        :param int n_data: the minimum number of data points per CHAD-person record used in sampling the CHAD data</span>

<span class="sd">        :return: the mean and standard deviation [in hours] for a given activity for \</span>
<span class="sd">        each person in the household</span>
<span class="sd">        :rtype: numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># load the empirical distribution based of the mean, standard deviation, and coefficient of variation</span>
        <span class="c1"># from the data frame</span>
        <span class="n">x_mean</span><span class="p">,</span> <span class="n">x_std</span><span class="p">,</span> <span class="n">x_cv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># choose the means for each person</span>
        <span class="n">x_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x_mean</span><span class="p">,</span> <span class="n">num_people</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_data</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># this will be over written for start time and end time</span>
            <span class="n">x_std</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_mean</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="p">(</span><span class="n">num_people</span><span class="p">,)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use the longitudinal data</span>
            <span class="n">x_std</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x_std</span><span class="p">,</span> <span class="n">num_people</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">x_std</span></div>

<div class="viewcode-block" id="Trial.get_stats_data_start_end"><a class="viewcode-back" href="../trial.html#trial.Trial.get_stats_data_start_end">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats_data_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_start</span><span class="p">,</span> <span class="n">df_end</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">n_data</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function samples data for activities that are parametrized \</span>
<span class="sd">        by both start time and end time activity-parameters.</span>

<span class="sd">        :param pandas.core.frame.DataFrame df_start: the CHAD data for start time [hours]</span>
<span class="sd">        :param pandas.core.frame.DataFrame df_end: the CHAD data for end time [hours]</span>
<span class="sd">        :param int num_people: the number of people in the household</span>
<span class="sd">        :param int n_data:  the number of data points to be considered &quot;longitudinal&quot;</span>

<span class="sd">        :return: the mean and standard deviation for the start time and end time respectively</span>
<span class="sd">        :rtype: numpy.ndarray, numpy.ndarray, numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the amount of time [hours] needed</span>
        <span class="n">SPACING</span>     <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># assign the start time and end time mean and standard deviation for each person</span>
        <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_start_end_help</span><span class="p">(</span> <span class="n">df_start</span><span class="p">,</span> <span class="n">df_end</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">n_data</span> <span class="p">)</span>

        <span class="c1"># get indices of overlapping start time and end time configurations</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_spacing</span><span class="p">(</span><span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span><span class="p">,</span> <span class="n">SPACING</span><span class="p">)</span>

        <span class="c1">#while there is a bad parametrization</span>
        <span class="k">while</span> <span class="n">idx</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>

            <span class="c1"># number of people who have a bad parametrization</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

            <span class="c1"># assign the start time and end time mean and standard deviation for each person</span>
            <span class="n">s_mean</span><span class="p">,</span> <span class="n">s_std</span><span class="p">,</span> <span class="n">e_mean</span><span class="p">,</span> <span class="n">e_std</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_start_end_help</span><span class="p">(</span><span class="n">df_start</span><span class="p">,</span> <span class="n">df_end</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">n_data</span><span class="p">)</span>

            <span class="c1"># assign the start time and time</span>
            <span class="n">start_mean</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">start_std</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_mean</span><span class="p">,</span> <span class="n">s_std</span>
            <span class="n">end_mean</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">end_std</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>     <span class="o">=</span> <span class="n">e_mean</span><span class="p">,</span> <span class="n">e_std</span>

            <span class="c1"># get indices of overlapping start time and end time configurations</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_spacing</span><span class="p">(</span><span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span><span class="p">,</span> <span class="n">SPACING</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span></div>

<div class="viewcode-block" id="Trial.get_stats_data_start_end_help"><a class="viewcode-back" href="../trial.html#trial.Trial.get_stats_data_start_end_help">[docs]</a>    <span class="k">def</span> <span class="nf">get_stats_data_start_end_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_start</span><span class="p">,</span> <span class="n">df_end</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">n_data</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function samples data for activities that are parametrized \</span>
<span class="sd">        by both start time and end time activity-parameters.</span>

<span class="sd">        :param pandas.core.frame.DataFrame df_start: the CHAD data for start time [hours]</span>
<span class="sd">        :param pandas.core.frame.DataFrame df_end: the CHAD data for end time [hours]</span>
<span class="sd">        :param int num_people: the number of people in the household</span>
<span class="sd">        :param int n_data:  the number of data points to be or not be considered &quot;longitudinal&quot;</span>


<span class="sd">        :return: the mean and standard deviation for the start time and end time respectively</span>
<span class="sd">        :rtype: numpy.ndarray, numpy.ndarray, numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># obtain the start time mean and standard deviation, respectively, for each agent in the household</span>
        <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_help</span><span class="p">(</span><span class="n">df_start</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">n_data</span><span class="p">)</span>

        <span class="c1"># obtain the end time mean and standard deviation, respectively, for each agent in the household</span>
        <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_stats_data_help</span><span class="p">(</span><span class="n">df_end</span><span class="p">,</span> <span class="n">num_people</span><span class="p">,</span> <span class="n">n_data</span><span class="p">)</span>

        <span class="c1"># in order to have a intra-individual variation for start time and end time, when there is no</span>
        <span class="c1"># longitudinal data, we use an approximation for intra-individual variation</span>
        <span class="k">if</span> <span class="n">n_data</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start_std</span><span class="p">,</span> <span class="n">end_std</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pseudo_intraindividual_variation</span><span class="p">(</span><span class="n">start_mean</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">start_mean</span><span class="p">,</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">,</span> <span class="n">end_std</span></div>

<div class="viewcode-block" id="Trial.initialize"><a class="viewcode-back" href="../trial.html#trial.Trial.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demo</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function initializes each activity in the trial for a given demographic by \</span>
<span class="sd">        using CHAD data to parametrize the activity-parameters (i.e., the mean \</span>
<span class="sd">        and standard deviation of star time, end time, and duration).</span>

<span class="sd">        :param chad_demography.CHAD_demography demo: contains much information about the demographic</span>

<span class="sd">        :return: a dictionary containing a tuple of the mean duration, standard deviation of duration, \</span>
<span class="sd">        mean start time, standard deviation of start time (in hours, float)</span>
<span class="sd">        :rtype: a dictionary of int to numpy.ndarray, numpy.ndarray, numpy.ndarray, numpy.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the demographic data</span>
        <span class="n">z</span>   <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">demo</span><span class="o">.</span><span class="n">fname_zip</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="c1"># dictionary of the file names for the statistical data</span>
        <span class="n">fname_stats</span> <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">fname_stats</span>

        <span class="c1"># activity codes for the activities that are done by the demographic</span>
        <span class="n">keys</span>    <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">keys</span>

        <span class="c1"># the sampling parameters for the initialization</span>
        <span class="n">sampling_params</span> <span class="o">=</span> <span class="n">demo</span><span class="o">.</span><span class="n">int_2_param</span>

        <span class="c1"># adjust_parameter() arguments</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># for each activity, assign the data about the mean and standard deviation</span>
        <span class="c1"># start time, end time, and duration</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>

            <span class="c1"># store the relevant file names</span>
            <span class="n">f_stats</span> <span class="o">=</span> <span class="n">fname_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="c1"># store the sampling parameters for this particular activity</span>
            <span class="n">s_params</span> <span class="o">=</span> <span class="n">sampling_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="c1"># recall: the times are in hours</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assign_chad_params</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f_stats</span><span class="p">,</span> <span class="n">s_params</span><span class="p">)</span>

            <span class="c1"># store the moments data for each activity in the dictionary</span>
            <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>

        <span class="c1"># close the zipfile</span>
        <span class="n">z</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="Trial.initialize_person"><a class="viewcode-back" href="../trial.html#trial.Trial.initialize_person">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_person</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function creates and initializes an agent with the proper parameters for \</span>
<span class="sd">        simulation.</span>

<span class="sd">        More specifically, the function does</span>

<span class="sd">        #. creates the agent</span>
<span class="sd">        #. initializes the agent&#39;s parameters to the respective values in :attr:`params`</span>

<span class="sd">        :param universe.Universe u: the universe the agent will reside in</span>
<span class="sd">        :param int idx: the index of the agent within the household</span>

<span class="sd">        :return p: the agent</span>
<span class="sd">        :rtype: singleton.Singleton</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create the person</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">singleton</span><span class="o">.</span><span class="n">Singleton</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">schedule</span><span class="p">)</span>

        <span class="c1"># set person to have relevant parameters</span>
        <span class="n">p</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

        <span class="c1"># initialize the person</span>
        <span class="n">p</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">local</span>    <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">HOME</span>

        <span class="c1"># set the state to idle</span>
        <span class="n">p</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">stats</span>       <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">IDLE</span>

        <span class="c1"># set the state&#39;s start time and end time to the current time [univeral time]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">t_start</span>     <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">t_univ</span>
        <span class="n">p</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">t_end</span>       <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">t_univ</span>

        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="Trial.pseudo_intraindividual_variation"><a class="viewcode-back" href="../trial.html#trial.Trial.pseudo_intraindividual_variation">[docs]</a>    <span class="k">def</span> <span class="nf">pseudo_intraindividual_variation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_mean</span><span class="p">,</span> <span class="n">end_mean</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function assigns intraindividual variation for start time and end time based data where</span>
<span class="sd">        there is **no** longitudinal data (hence the name &quot;pseudo&quot;). The variation is assigned by</span>
<span class="sd">        having the following assumptions:</span>

<span class="sd">        #. Given that the mean start time and end time are assigned</span>
<span class="sd">        #. Calculate the mean duration based on the mean start time and mean end time</span>
<span class="sd">        #. Calculate the variance of the start time and end time with the following assumptions</span>
<span class="sd">            * assume that start time and end time are independent</span>
<span class="sd">            * variance of start time is equal to the variance of the end time</span>
<span class="sd">            * standard deviation of the duration is set to be the coefficient of variation times \</span>
<span class="sd">            the previously calculated mean duration</span>

<span class="sd">        These assumptions are expressed mathematically below where</span>

<span class="sd">        * :math:`X_{start}, X_{end}, X_{\\Delta{t}}` are random variables for the start time, end time, \</span>
<span class="sd">        and duration, respectively</span>
<span class="sd">        * :math:`\\sigma^2, \\sigma, c_v` are the variance, standard deviation, and coefficient of variation</span>
<span class="sd">        * :math:`E[\\cdot], Cov(\\cdot, \\cdot)` are the expected value operator and covariance  operator</span>

<span class="sd">        Given :math:`X_{start}` and :math:`X_{end}`,</span>

<span class="sd">        Let,</span>

<span class="sd">        .. math::</span>
<span class="sd">            X_{\\Delta{t}} = X_{end} - X_{start}</span>

<span class="sd">        Then,</span>

<span class="sd">        .. math::</span>
<span class="sd">            \\sigma^2_{\\Delta{t}} = \\sigma^2_{start}  + \\sigma^2_{end} - 2*Cov(X_{start}, X_{end})</span>

<span class="sd">        Assuming :math:`X_{start}` and :math:`X_{end}` are independent, then,</span>

<span class="sd">        .. math::</span>
<span class="sd">            \\sigma^2_{\\Delta{t}} = \\sigma^2_{start}  + \\sigma^2_{end}</span>

<span class="sd">        Assuming :math:`\\sigma^2_{start}  = \\sigma^2_{end}`, then,</span>

<span class="sd">        .. math::</span>
<span class="sd">            \\sigma^2_{\\Delta{t}} = 2\\sigma^2_{start}</span>

<span class="sd">        Finally,</span>

<span class="sd">        .. math::</span>
<span class="sd">             \\sigma_{start} &amp;= \\frac{ \\sigma_{\\Delta{t}} }{ \\sqrt{2} } \\\\</span>
<span class="sd">             \\sigma_{start} = \\sigma_{end} &amp;= \\frac{ c_v E[ X_{\\Delta{t}} ] }{ \\sqrt{2} }</span>

<span class="sd">        :param numpy.ndarray start_mean: the mean start time [in hours] for each person bing parametrized</span>
<span class="sd">        :param numpy.ndarray end_mean: the mean end time [in hours] for each person being parametrized</span>

<span class="sd">        :return: standard deviation for start time and end time, respectively for each person being parametrized</span>
<span class="sd">        :rytpe: numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the mean duration</span>
        <span class="n">dt_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_mean</span> <span class="o">-</span> <span class="n">start_mean</span><span class="p">)</span> <span class="o">%</span> <span class="mi">24</span>

        <span class="c1"># assign the coefficient of variation for longer durations</span>
        <span class="k">if</span> <span class="n">dt_mean</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">LONG_DURATION</span><span class="p">:</span>
            <span class="n">cv</span>  <span class="o">=</span> <span class="n">CV_LONG</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cv</span>  <span class="o">=</span> <span class="n">CV_SHORT</span>

        <span class="c1"># assign the standard deviation for the duration</span>
        <span class="n">dt_std</span>  <span class="o">=</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">dt_mean</span>

        <span class="c1"># the standard deviation from our assumptions</span>
        <span class="n">std</span>     <span class="o">=</span> <span class="n">dt_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># assign the start time and end time standard deviation</span>
        <span class="n">start_std</span><span class="p">,</span> <span class="n">end_std</span>   <span class="o">=</span> <span class="n">std</span><span class="p">,</span> <span class="n">std</span>

        <span class="k">return</span> <span class="n">start_std</span><span class="p">,</span> <span class="n">end_std</span></div>

<div class="viewcode-block" id="Trial.run"><a class="viewcode-back" href="../trial.html#trial.Trial.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function runs 1 simulations of the ABMHAP using data from \</span>
<span class="sd">        CHAD. The function can handle having more than 1 person in the household.</span>

<span class="sd">        More specifically the function does the following for each simulation:</span>

<span class="sd">        #. creates the universe</span>
<span class="sd">        #. create / initialize the person</span>
<span class="sd">        #. run the ABMHAP simulation</span>
<span class="sd">        #. store the results / data from the simulation</span>

<span class="sd">        :return u: the results of the simulation</span>
<span class="sd">        :rtype: universe.Universe</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create the universe</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_universe</span><span class="p">()</span>

        <span class="c1"># create and add person to universe initialized appropriately</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">num_people</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_person_to_universe</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># run the ABMHAP simulation</span>
        <span class="n">u</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="c1">#</span>
        <span class="n">diary_hhld_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_diary</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">diary_hhld_list</span></div>

    <span class="c1"># def run_uni(self):</span>
    <span class="c1">#</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This function runs 1 simulations of the ABMHAP using data from CHAD. \</span>
    <span class="c1">#     The function can handle having more than 1 person in the household.</span>
    <span class="c1">#</span>
    <span class="c1">#     More specifically the function does the following for each simulation:</span>
    <span class="c1">#</span>
    <span class="c1">#     #. creates the universe</span>
    <span class="c1">#     #. create / initialize the person</span>
    <span class="c1">#     #. run the ABM simulation</span>
    <span class="c1">#     #. store the results / data from the simulation</span>
    <span class="c1">#</span>
    <span class="c1">#     :return u: the results of the simulation</span>
    <span class="c1">#     :rtype: universe.Universe</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     # run the simulation</span>
    <span class="c1">#     u = self.create_universe()</span>
    <span class="c1">#</span>
    <span class="c1">#     # create and add person to universe initialized appropriately</span>
    <span class="c1">#     for i in range(self.params.num_people):</span>
    <span class="c1">#         self.add_person_to_universe(u, idx=i)</span>
    <span class="c1">#</span>
    <span class="c1">#     # run the ABM simulation</span>
    <span class="c1">#     u.run()</span>
    <span class="c1">#</span>
    <span class="c1">#     return u</span>

<div class="viewcode-block" id="Trial.sample"><a class="viewcode-back" href="../trial.html#trial.Trial.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function samples the statistical data (of activity moments) from the CHAD diaries.</span>

<span class="sd">        The function samples the **distributions** of both the means and the \</span>
<span class="sd">        the standard deviations independently of each other.</span>

<span class="sd">        :param pandas.core.frame.DataFrame df: a list of statistical data (mean, standard deviation, \</span>
<span class="sd">        coefficient of variation) for activity information (duration, start, or end)</span>

<span class="sd">        :return: values for the mean, standard deviation, and coefficient of variation, respectively</span>
<span class="sd">        :rtype: numpy.ndarray, numpy.ndarray, numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the number of values to sample.</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># sample for mean values</span>
        <span class="n">data_mean</span>   <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">N</span> <span class="p">)</span>

        <span class="c1"># sample standard deviation values</span>
        <span class="n">data_std</span>    <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">N</span> <span class="p">)</span>

        <span class="c1"># sample for coefficient of variation</span>
        <span class="c1"># use only finite values of coefficient of variation</span>
        <span class="n">x</span>           <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cv&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">data_cv</span>     <span class="o">=</span> <span class="n">mg</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span> <span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span> <span class="n">N</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">data_mean</span><span class="p">,</span> <span class="n">data_std</span><span class="p">,</span> <span class="n">data_cv</span></div></div>

    <span class="c1"># def sample_N(self, df, N, do_solo=False):</span>
    <span class="c1">#</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This function returns CHAD data from entries with either \</span>
    <span class="c1">#     single-day data or longitudinal data.</span>
    <span class="c1">#</span>
    <span class="c1">#     :param pandas.core.frame.DataFrame df: the statistical results</span>
    <span class="c1">#     :param bool do_solo: a flag indicating whether to sample people with single-day \</span>
    <span class="c1">#     entries only (if True) or not (if False)</span>
    <span class="c1">#     :param int N: the minimum amount of events that are needed in sampling the \</span>
    <span class="c1">#     activity data</span>
    <span class="c1">#</span>
    <span class="c1">#     :return: the selected CHAD data</span>
    <span class="c1">#     :rtype: pandas.core.frame.DataFrame</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     if do_solo:</span>
    <span class="c1">#         x = df[df.N == 1]</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         x = df[df.N &gt;= N]</span>
    <span class="c1">#</span>
    <span class="c1">#     return x</span>

    <span class="c1"># def sample_dt(self, df, s_params):</span>
    <span class="c1">#</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This function goes through the CHAD activity duration data and gets information that \</span>
    <span class="c1">#     have the appropriate characteristics.</span>
    <span class="c1">#</span>
    <span class="c1">#     .. math::</span>
    <span class="c1">#</span>
    <span class="c1">#         \\begin{cases}</span>
    <span class="c1">#             \\mu_{min} &amp;\\le \\mu \\le \\mu_{max} \\\\</span>
    <span class="c1">#             \\sigma &amp;\\le \\sigma_{max}</span>
    <span class="c1">#         \\end{cases}</span>
    <span class="c1">#</span>
    <span class="c1">#     where</span>
    <span class="c1">#</span>
    <span class="c1">#         * :math:`\\mu` is the mean activity duration [in hours]</span>
    <span class="c1">#         * :math:`\\mu_{min}` is the minimum mean activity duration [in hours]</span>
    <span class="c1">#         * :math:`\\mu_{max}` is the maximum mean activity duration [in hours]</span>
    <span class="c1">#         * :math:`\\sigma` is the standard deviation of activity duration [in hours]</span>
    <span class="c1">#         * :math:`\\sigma_{max}` is the maximum standard deviation of activity duration [in hours]</span>
    <span class="c1">#</span>
    <span class="c1">#     :param pandas.core.frame.DataFrame df: the CHAD statistical data</span>
    <span class="c1">#     :param chad_params.CHAD_params s_params: the parameters the limit the sampling of CHAD data</span>
    <span class="c1">#</span>
    <span class="c1">#     :return: the respective activity duration data</span>
    <span class="c1">#     :rtype: pandas.core.frame.DataFrame</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     # the parameters that limit the CHAD data for the activity for duration (mean &amp; standard deviation)</span>
    <span class="c1">#     mean_min, mean_max, std_max = s_params.dt_mean_min, s_params.dt_mean_max, s_params.dt_std_max</span>
    <span class="c1">#</span>
    <span class="c1">#     # get a flag for single activity data only &amp; the minimum number of activity-data to get in sampling</span>
    <span class="c1">#     do_solo, N = s_params.do_solo, s_params.N</span>
    <span class="c1">#</span>
    <span class="c1">#     # get data according to limits on the mean &amp; standard deviation</span>
    <span class="c1">#     y = df[ (df[&#39;mu&#39;].values &gt;= mean_min) &amp; (df[&#39;mu&#39;].values &lt;= mean_max) ]</span>
    <span class="c1">#</span>
    <span class="c1">#     # sample according to the number of activity-diary entries per person</span>
    <span class="c1">#     y = self.sample_N(y, N=N, do_solo=do_solo)</span>
    <span class="c1">#</span>
    <span class="c1">#     return y</span>

    <span class="c1"># def sample_end(self, df, s_params, do_periodic=False):</span>
    <span class="c1">#</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This function goes through the CHAD activity end time data and gets \</span>
    <span class="c1">#     information that have the appropriate characteristics.</span>
    <span class="c1">#</span>
    <span class="c1">#     .. math::</span>
    <span class="c1">#</span>
    <span class="c1">#         \\begin{cases}</span>
    <span class="c1">#             \\mu_{min} &amp;\\le \\mu \\le \\mu_{max} \\\\</span>
    <span class="c1">#             \\sigma &amp;\\le \\sigma_{max}</span>
    <span class="c1">#         \\end{cases}</span>
    <span class="c1">#</span>
    <span class="c1">#     where</span>
    <span class="c1">#</span>
    <span class="c1">#         * :math:`\\mu` is the mean activity end time [hours, periodic time]</span>
    <span class="c1">#         * :math:`\\mu_{min}` is the minimum mean activity end time [hours, periodic time]</span>
    <span class="c1">#         * :math:`\\mu_{max}` is the maximum mean activity end time [hours, periodic time]</span>
    <span class="c1">#         * :math:`\\sigma` is the standard deviation of activity end time [hours]</span>
    <span class="c1">#         * :math:`\\sigma_{max}` is the maximum standard deviation of end time[hours]</span>
    <span class="c1">#</span>
    <span class="c1">#     :param pandas.core.frame.DataFrame df: the statistical end time data</span>
    <span class="c1">#     :param chad_params.CHAD_params s_params: the parameters the limit the sampling of CHAD data</span>
    <span class="c1">#     :param bool do_periodic: a flag to indicate whether the data for end time should be analyzed \</span>
    <span class="c1">#     in periodic form [-12, 12) instead of [0, 24)</span>
    <span class="c1">#</span>
    <span class="c1">#     :return: the respective end time time data [hours]</span>
    <span class="c1">#     :rtype: pandas.core.frame.DataFrame</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     # put the time values in range [-12, 12)</span>
    <span class="c1">#     t_mean = df[&#39;mu&#39;].values</span>
    <span class="c1">#</span>
    <span class="c1">#     # the parameters that limit the CHAD data for the activity for end time (mean &amp; standard deviation)</span>
    <span class="c1">#     mean_min, mean_max, std_max = s_params.end_mean_min, s_params.end_mean_max, s_params.end_std_max</span>
    <span class="c1">#</span>
    <span class="c1">#     # get single activity data only</span>
    <span class="c1">#     do_solo, N = s_params.do_solo, s_params.N</span>
    <span class="c1">#</span>
    <span class="c1">#     # if an event may occur over midnight, express the time [-12, 12)</span>
    <span class="c1">#     if do_periodic:</span>
    <span class="c1">#</span>
    <span class="c1">#         # put the time values in range [-12, 12)</span>
    <span class="c1">#</span>
    <span class="c1">#         # put in periodic time</span>
    <span class="c1">#         mean_min    = mg.to_periodic(mean_min)</span>
    <span class="c1">#         mean_max    = mg.to_periodic(mean_max)</span>
    <span class="c1">#         t_mean      = mg.to_periodic(t_mean)</span>
    <span class="c1">#</span>
    <span class="c1">#     # get data according to limits on the mean &amp; standard deviation</span>
    <span class="c1">#     y = df[ (t_mean &gt;= mean_min) &amp; (t_mean &lt;= mean_max) ]</span>
    <span class="c1">#</span>
    <span class="c1">#     # sample according to the number of activity-diary entries per person</span>
    <span class="c1">#     y = self.sample_N(y, N=N, do_solo=do_solo)</span>
    <span class="c1">#</span>
    <span class="c1">#     return y</span>


    <span class="c1"># def sample_start(self, df, s_params, do_periodic=False):</span>
    <span class="c1">#</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This function goes through the CHAD activity start time data \</span>
    <span class="c1">#     and gets information that have the appropriate characteristics.</span>
    <span class="c1">#</span>
    <span class="c1">#     .. math::</span>
    <span class="c1">#</span>
    <span class="c1">#         \\begin{cases}</span>
    <span class="c1">#             \\mu_{min} &amp;\\le \\mu \\le \\mu_{max} \\\\</span>
    <span class="c1">#             \\sigma &amp;\\le \\sigma_{max}</span>
    <span class="c1">#         \\end{cases}</span>
    <span class="c1">#</span>
    <span class="c1">#     where</span>
    <span class="c1">#</span>
    <span class="c1">#         * :math:`\\mu` is the mean activity start time [hours, periodic time]</span>
    <span class="c1">#         * :math:`\\mu_{min}` is the minimum mean activity start time [hours, periodic time]</span>
    <span class="c1">#         * :math:`\\mu_{max}` is the maximum mean activity start time [hours, periodic time]</span>
    <span class="c1">#         * :math:`\\sigma` is the standard deviation of activity start time [hours]</span>
    <span class="c1">#         * :math:`\\sigma_{max}` is the maximum standard deviation of start time[hours]</span>
    <span class="c1">#</span>
    <span class="c1">#     :param pandas.core.frame.DataFrame df: the statistical start time data</span>
    <span class="c1">#     :param chad_params.CHAD_param s_params: the parameters the limit the sampling of CHAD data</span>
    <span class="c1">#     :param bool do_periodic: a flag to indicate whether the data should be analyzed in periodic form [-12, 12) \</span>
    <span class="c1">#     instead of [0, 24)</span>
    <span class="c1">#</span>
    <span class="c1">#     :return: the start time time data [in hours]</span>
    <span class="c1">#     :rtype: pandas.core.frame.DataFrame</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     # put the time values in range [-12, 12)</span>
    <span class="c1">#     t_mean = df[&#39;mu&#39;].values</span>
    <span class="c1">#</span>
    <span class="c1">#     # the parameters that limit the CHAD data for the activity for start time (mean &amp; standard deviation)</span>
    <span class="c1">#     mean_min, mean_max, std_max = s_params.start_mean_min, s_params.start_mean_max, s_params.start_std_max</span>
    <span class="c1">#</span>
    <span class="c1">#     # get single activity data only</span>
    <span class="c1">#     do_solo, N = s_params.do_solo, s_params.N</span>
    <span class="c1">#</span>
    <span class="c1">#     # if an event may occur over midnight, express the time [-12, 12)</span>
    <span class="c1">#     if do_periodic:</span>
    <span class="c1">#</span>
    <span class="c1">#         # put the time values in range [-12, 12)</span>
    <span class="c1">#</span>
    <span class="c1">#         # put in periodic time</span>
    <span class="c1">#         mean_min    = mg.to_periodic(mean_min)</span>
    <span class="c1">#         mean_max    = mg.to_periodic(mean_max)</span>
    <span class="c1">#         t_mean      = mg.to_periodic(t_mean)</span>
    <span class="c1">#</span>
    <span class="c1">#     # get data according to limits on the mean &amp; standard deviation</span>
    <span class="c1">#     y = df[(t_mean &gt;= mean_min) &amp; (t_mean &lt;= mean_max)]</span>
    <span class="c1">#</span>
    <span class="c1">#     # sample according to the number of activity-diary entries per person</span>
    <span class="c1">#     y = self.sample_N(y, N=N, do_solo=do_solo)</span>
    <span class="c1">#</span>
    <span class="c1">#     return y</span>

    <span class="c1"># def set_std(self, x_mean, x_std, N):</span>
    <span class="c1">#</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     :param numpy.ndarray x_mean:</span>
    <span class="c1">#     :param numpy.ndarray x_std:</span>
    <span class="c1">#     :param int  N:</span>
    <span class="c1">#</span>
    <span class="c1">#     :return:</span>
    <span class="c1">#     :rtype: numpy.ndarray</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1">#     results = np.zeros(x_mean.shape)</span>
    <span class="c1">#</span>
    <span class="c1">#     if N &gt; 1:</span>
    <span class="c1">#         results[:]  = np.mean(x_std)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         results[:]  = np.std(x_mean)</span>
    <span class="c1">#</span>
    <span class="c1">#     return results</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Namdi Brandon.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>